
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <title>✨ Pro Text Overlay Studio</title>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&family=Montserrat:wght@300;400;600;700&family=Poppins:wght@300;400;600;700&family=Lora:wght@400;500;600&family=Dancing+Script:wght@400;700&family=Great+Vibes&family=Bebas+Neue&family=Rajdhani:wght@300;400;600;700&family=Oswald:wght@300;400;700&family=Inter:wght@300;400;500;600;700&family=Roboto+Slab:wght@300;400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: linear-gradient(135deg, #3b82f6, #1d4ed8);
            --success: linear-gradient(135deg, #10b981, #059669);
            --warning: linear-gradient(135deg, #f59e0b, #d97706);
            --danger: linear-gradient(135deg, #ef4444, #dc2626);
            --secondary: linear-gradient(135deg, #6b7280, #4b5563);
            --dark-bg: #1e293b;
            --light-bg: #f8fafc;
            --border-dark: #475569;
            --border-light: #d1d5db;
            --text-primary-dark: #f1f5f9;
            --text-primary-light: #1e293b;
            --text-secondary-dark: #94a3b8;
            --text-secondary-light: #6b7280;
            --panel-bg-dark: rgba(30, 41, 59, 0.9);
            --panel-bg-light: rgba(255, 255, 255, 0.95);
        }
        * { box-sizing: border-box; }
        body {
            font-family: 'Inter', 'Segoe UI', sans-serif;
            margin: 0;
            color: var(--text-primary-dark);
            background: linear-gradient(135deg, #0f172a, #1e293b);
            transition: all 0.3s ease;
            line-height: 1.6;
        }
        body.light {
            background: linear-gradient(135deg, #f1f5f9, #e2e8f0);
            color: var(--text-primary-light);
        }
       
        .container { display: flex; flex-direction: column; align-items: center; padding: 20px; max-width: 1400px; margin: 0 auto; }
        .top-row { display: flex; flex-wrap: wrap; justify-content: center; width: 100%; gap: 24px; }
        .panel { 
            background: var(--panel-bg-dark); 
            backdrop-filter: blur(16px); 
            border-radius: 20px; 
            padding: 24px; 
            box-shadow: 0 8px 32px rgba(0, 0, 0, .3); 
            flex: 1; 
            min-width: 320px; 
            max-width: 600px; 
            border: 1px solid rgba(59, 130, 246, 0.2); 
        }
        body.light .panel { 
            background: var(--panel-bg-light); 
            border: 1px solid rgba(59, 130, 246, 0.1); 
        }
       
        h1 { 
            text-align: center; 
            font-size: 28px; 
            margin: 0 0 20px; 
            background: var(--primary); 
            -webkit-background-clip: text; 
            -webkit-text-fill-color: transparent; 
            background-clip: text; 
        }
        h2 { 
            margin: 0 0 16px; 
            font-size: 20px; 
            color: #93c5fd; 
            font-weight: 700; 
            display: flex; 
            align-items: center; 
            gap: 8px; 
        }
        body.light h2 { color: #1d4ed8; }
        h3 { 
            margin: 20px 0 12px; 
            font-size: 16px; 
            color: var(--text-primary-dark); 
            border-left: 4px solid #3b82f6; 
            padding-left: 16px; 
            font-weight: 600; 
        }
        body.light h3 { color: var(--text-primary-light); }
       
        label { 
            display: block; 
            margin: 12px 0 6px; 
            font-weight: 600; 
            font-size: 13px; 
            color: var(--text-primary-dark); 
        }
        body.light label { color: var(--text-primary-light); }
        input, textarea, select {
            width: 100%; 
            padding: 12px; 
            margin: 4px 0; 
            border: 2px solid var(--border-dark);
            border-radius: 12px; 
            background: var(--dark-bg); 
            color: var(--text-primary-dark);
            font-size: 13px; 
            transition: all 0.2s; 
            font-family: inherit;
        }
        body.light input, 
        body.light textarea, 
        body.light select { 
            background: #ffffff; 
            border-color: var(--border-light); 
            color: var(--text-primary-light); 
        }
        input:focus, textarea:focus, select:focus { 
            outline: none; 
            border-color: #3b82f6; 
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1); 
        }
        input[type="color"] { 
            height: 40px; 
            padding: 4px; 
            cursor: pointer; 
            border-radius: 8px; 
            background: transparent;
            border: 2px solid var(--border-dark);
        }
        body.light input[type="color"] { border-color: var(--border-light); }
        input[type="range"] { cursor: pointer; height: 6px; }
       
        .slider-container { 
            display: flex; 
            align-items: center; 
            gap: 12px; 
            margin: 8px 0; 
        }
        .slider-value { 
            font-size: 12px; 
            color: var(--text-secondary-dark); 
            min-width: 40px; 
            text-align: center; 
            font-weight: 500; 
        }
        body.light .slider-value { color: var(--text-secondary-light); }
       
        .btn {
            display: inline-flex; 
            align-items: center; 
            gap: 6px;
            margin: 6px 4px; 
            padding: 12px 20px; 
            border: none; 
            border-radius: 12px;
            background: var(--primary); 
            color: white; 
            cursor: pointer; 
            font-weight: 600;
            font-size: 13px; 
            transition: all 0.2s; 
            box-shadow: 0 2px 8px rgba(0,0,0,0.15);
            text-decoration: none;
        }
        .btn:hover:not(:disabled) { 
            transform: translateY(-2px); 
            box-shadow: 0 4px 16px rgba(0,0,0,0.2); 
        }
        .btn:disabled { 
            opacity: 0.5; 
            cursor: not-allowed; 
            transform: none; 
        }
        .btn-primary { background: var(--success); }
        .btn-secondary { background: var(--secondary); }
        .btn-danger { background: var(--danger); }
        .btn-warning { background: var(--warning); }
       
        .progress-container { 
            margin: 16px 0; 
            height: 10px; 
            background: rgba(71, 85, 105, 0.3); 
            border-radius: 5px; 
            overflow: hidden; 
        }
        body.light .progress-container { background: rgba(209, 213, 219, 0.3); }
        .progress-bar { 
            height: 100%; 
            width: 0; 
            background: var(--success); 
            transition: width 0.3s ease; 
            border-radius: 5px; 
        }
       
        .status-text {
            margin: 16px 0; 
            padding: 16px; 
            background: rgba(59, 130, 246, 0.1);
            border-radius: 12px; 
            border-left: 4px solid #3b82f6; 
            font-size: 13px;
            line-height: 1.5; 
            animation: pulse 2s infinite;
            color: var(--text-primary-dark);
        }
        body.light .status-text {
            background: rgba(59, 130, 246, 0.05);
            color: var(--text-primary-light);
        }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.7; } }
       
        .results { 
            display: grid; 
            gap: 20px; 
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); 
        }
        .result-item {
            background: var(--panel-bg-dark); 
            border-radius: 16px; 
            padding: 20px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, .3); 
            transition: all 0.3s;
            border: 1px solid rgba(59, 130, 246, 0.2); 
            position: relative; 
            overflow: hidden;
            color: var(--text-primary-dark);
        }
        body.light .result-item {
            background: var(--panel-bg-light);
            border-color: rgba(59, 130, 246, 0.1);
            color: var(--text-primary-light);
        }
        .result-item::before {
            content: ''; 
            position: absolute; 
            top: 0; 
            left: 0; 
            right: 0; 
            height: 4px;
            background: var(--success);
        }
        .result-item:hover { 
            transform: translateY(-4px); 
            box-shadow: 0 12px 40px rgba(0, 0, 0, .4); 
        }
        .result-item img { 
            max-width: 100%; 
            border-radius: 12px; 
            box-shadow: 0 4px 16px rgba(0,0,0,0.3); 
        }
        .result-meta { 
            margin: 12px 0; 
            font-size: 12px; 
            color: var(--text-secondary-dark); 
        }
        body.light .result-meta { color: var(--text-secondary-light); }
       
        .preview { 
            text-align: center; 
            position: relative; 
        }
        .preview canvas { 
            max-width: 100%; 
            border-radius: 16px; 
            box-shadow: 0 8px 32px rgba(0, 0, 0, .4); 
            border: 3px solid transparent; 
        }
        .preview-info { 
            position: absolute; 
            bottom: 10px; 
            right: 10px; 
            background: rgba(0,0,0,0.7); 
            color: white; 
            padding: 6px 12px; 
            border-radius: 20px; 
            font-size: 11px; 
        }
       
        /* Enhanced Tab System */
        .tab-buttons {
            display: flex; 
            gap: 4px; 
            margin: 20px 0; 
            background: rgba(71, 85, 105, 0.2);
            border-radius: 16px; 
            padding: 4px; 
            box-shadow: inset 0 2px 8px rgba(0,0,0,0.1);
        }
        body.light .tab-buttons { background: rgba(209, 213, 219, 0.2); }
        .tab-btn {
            flex: 1; 
            padding: 14px 12px; 
            border: none; 
            border-radius: 12px;
            background: transparent; 
            color: var(--text-secondary-dark); 
            cursor: pointer;
            font-size: 14px; 
            font-weight: 600; 
            transition: all 0.3s ease; 
            position: relative;
            display: flex; 
            align-items: center; 
            justify-content: center; 
            gap: 8px;
        }
        body.light .tab-btn { color: var(--text-secondary-light); }
        .tab-btn.active {
            background: var(--primary); 
            color: white;
            box-shadow: 0 4px 16px rgba(59, 130, 246, 0.3); 
            transform: translateY(-2px);
        }
        body.light .tab-btn.active { 
            background: var(--primary); 
            color: white; 
        }
       
        .tab-content { display: none; animation: slideIn 0.4s ease; }
        .tab-content.active { display: block; }
        @keyframes slideIn { 
            from { opacity: 0; transform: translateX(20px); } 
            to { opacity: 1; transform: translateX(0); } 
        }
       
        /* CSV Section */
        .csv-section { position: relative; margin: 20px 0; }
        .csv-container { 
            position: relative; 
            background: rgba(30, 41, 59, 0.3); 
            border-radius: 16px; 
            padding: 20px; 
            border: 2px dashed var(--border-dark); 
            transition: all 0.2s; 
        }
        body.light .csv-container { 
            background: rgba(248, 250, 252, 0.5); 
            border-color: var(--border-light); 
        }
        .csv-container.dragover { 
            border-color: #3b82f6; 
            background: rgba(59, 130, 246, 0.05); 
            transform: scale(1.02); 
        }
        body.light .csv-container.dragover { background: rgba(59, 130, 246, 0.02); }
        .csv-textarea { 
            min-height: 140px; 
            resize: vertical; 
            font-family: 'Courier New', monospace; 
            font-size: 12px; 
            line-height: 1.4; 
            color: var(--text-primary-dark);
        }
        body.light .csv-textarea { color: var(--text-primary-light); }
        .csv-textarea.minimized { 
            min-height: 50px !important; 
            max-height: 50px !important; 
            overflow: hidden !important; 
        }
        .csv-toggle {
            position: absolute; 
            top: 20px; 
            right: 20px; 
            background: var(--secondary);
            color: white; 
            border: none; 
            border-radius: 50%; 
            width: 32px; 
            height: 32px;
            font-size: 16px; 
            cursor: pointer; 
            transition: all 0.2s; 
            z-index: 10;
        }
        .csv-toggle:hover { 
            background: var(--primary); 
            transform: scale(1.1); 
        }
        .csv-toggle.minimized { background: var(--danger); }
       
        .csv-example {
            background: rgba(16, 185, 129, 0.1); 
            border: 1px solid rgba(16, 185, 129, 0.3);
            border-radius: 12px; 
            padding: 16px; 
            margin: 12px 0; 
            font-size: 12px;
            color: #10b981; 
            line-height: 1.6; 
            font-family: 'Courier New', monospace;
        }
        body.light .csv-example { 
            background: rgba(16, 185, 129, 0.05); 
            color: #166534; 
            border-color: rgba(16, 185, 129, 0.2); 
        }
       
        /* Presets */
        .preset-section {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.05), rgba(16, 185, 129, 0.05));
            border: 1px solid rgba(59, 130, 246, 0.15); 
            border-radius: 16px;
            padding: 20px; 
            margin: 20px 0; 
            display: flex; 
            gap: 12px; 
            flex-wrap: wrap; 
            justify-content: center;
        }
        body.light .preset-section {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.02), rgba(16, 185, 129, 0.02));
            border-color: rgba(59, 130, 246, 0.1);
        }
        .preset-btn {
            padding: 10px 16px; 
            font-size: 13px; 
            font-weight: 600; 
            border-radius: 10px;
            border: none; 
            cursor: pointer; 
            transition: all 0.2s; 
            min-width: 100px;
            display: flex; 
            align-items: center; 
            justify-content: center; 
            gap: 6px;
            color: white;
        }
        .preset-btn:hover { 
            transform: translateY(-2px); 
            box-shadow: 0 4px 12px rgba(0,0,0,0.15); 
        }
        .preset-instagram { background: linear-gradient(135deg, #e4405f, #f77737); }
        .preset-youtube { background: linear-gradient(135deg, #ff0000, #cc0000); }
        .preset-tiktok { background: linear-gradient(135deg, #000000, #252525); }
        .preset-twitter { background: linear-gradient(135deg, #1da1f2, #0d8bd9); }
        .preset-linkedin { background: linear-gradient(135deg, #0077b5, #005885); }
       
        /* Control Grid */
        .control-grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); 
            gap: 20px; 
            margin: 20px 0; 
        }
        .control-group { 
            background: rgba(71, 85, 105, 0.1); 
            padding: 20px; 
            border-radius: 16px; 
            border: 1px solid rgba(71, 85, 105, 0.2); 
        }
        body.light .control-group { 
            background: rgba(248, 250, 252, 0.5); 
            border-color: rgba(209, 213, 219, 0.5); 
        }
       
        /* Buttons Group */
        .btn-group {
            display: flex; 
            flex-wrap: wrap; 
            gap: 12px; 
            margin: 20px 0;
            padding: 20px; 
            background: rgba(71, 85, 105, 0.1); 
            border-radius: 16px;
            justify-content: center;
        }
        body.light .btn-group { background: rgba(248, 250, 252, 0.3); }
       
        /* File Upload */
        .file-upload { position: relative; display: inline-block; margin: 8px; }
        .file-upload input[type=file] { position: absolute; left: -9999px; }
        .file-upload-label {
            display: inline-flex; 
            align-items: center; 
            gap: 8px;
            padding: 12px 20px; 
            background: var(--secondary); 
            color: white;
            border-radius: 12px; 
            cursor: pointer; 
            transition: all 0.2s; 
            font-weight: 500;
        }
        .file-upload-label:hover { 
            background: var(--primary); 
            transform: translateY(-1px); 
        }
       
        /* Responsive */
        @media (max-width: 768px) {
            .container { padding: 12px; }
            .top-row { flex-direction: column; gap: 16px; }
            .panel { min-width: unset; padding: 16px; }
            .tab-buttons { flex-direction: column; margin: 12px 0; }
            .btn-group { flex-direction: column; align-items: stretch; }
            .control-grid { grid-template-columns: 1fr; }
            h1 { font-size: 24px; }
        }
       
        /* Fixed positioning */
        #themeToggle, #goToTop {
            position: fixed; 
            z-index: 1000; 
            border: none; 
            border-radius: 50%;
            width: 48px; 
            height: 48px; 
            display: flex; 
            align-items: center;
            justify-content: center; 
            font-size: 16px; 
            cursor: pointer;
            transition: all 0.2s; 
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        }
        #themeToggle { 
            top: 20px; 
            right: 20px; 
            background: var(--secondary); 
            color: white; 
        }
        #themeToggle:hover { 
            background: var(--primary); 
            transform: scale(1.1); 
        }
        #goToTop { 
            bottom: 20px; 
            right: 20px; 
            background: var(--primary); 
            color: white; 
            display: none; 
        }
        #goToTop:hover { 
            background: var(--success); 
            transform: scale(1.1); 
        }
       
        /* Loading Animation */
        .loading { 
            display: inline-block; 
            width: 16px; 
            height: 16px; 
            border: 2px solid rgba(255,255,255,0.3); 
            border-radius: 50%; 
            border-top-color: white; 
            animation: spin 1s ease-in-out infinite; 
        }
        @keyframes spin { to { transform: rotate(360deg); } }
       
        /* Success Animation */
        .success { animation: success 0.6s ease; }
        @keyframes success { 
            0% { transform: scale(0.8); opacity: 0; } 
            50% { transform: scale(1.05); } 
            100% { transform: scale(1); opacity: 1; } 
        }
    </style>
</head>
<body class="dark">
    <div class="container">
        <h1>✨ Pro Text Overlay Studio</h1>
       
        <div class="top-row">
            <div class="panel preview-panel">
                <h2>🔍 Live Preview</h2>
                <div class="preview">
                    <canvas id="previewCanvas"></canvas>
                    <div class="preview-info" id="previewInfo">
                        <div>Ready</div>
                        <div id="previewDimensions">-</div>
                    </div>
                </div>
                <div style="margin-top: 16px; padding: 12px; background: rgba(16, 185, 129, 0.1); border-radius: 12px; font-size: 12px; text-align: center; color: #10b981;">
                    <strong>🎯 Pro Tip:</strong> All changes update instantly • Exports match preview pixel-perfect
                </div>
            </div>
           
            <div class="panel control-panel">
                <div class="tab-buttons">
                    <button class="tab-btn active" data-tab="generator">
                        <span>⚡</span> Generator
                    </button>
                    <button class="tab-btn" data-tab="title">
                        <span>🎨</span> Title Studio
                    </button>
                    <button class="tab-btn" data-tab="detail">
                        <span>📝</span> Detail Studio
                    </button>
                </div>
                <!-- Generator Tab -->
                <div id="generator-tab" class="tab-content active">
                    <div class="csv-section">
                        <div class="csv-container" id="csvDropZone">
                            <label>📁 Content Source</label>
                            <textarea id="csvInput" class="csv-textarea" placeholder="Paste your CSV data here or drag & drop a file...&#10;&#10;Format: image_url,title,detail_text&#10;Supports empty fields ✓ Multi-line text with \n&#10;&#10;Example:&#10;https://example.com/image.jpg,Awesome Title,This is a\nmulti-line\ndescription" rows="8"></textarea>
                            <button class="csv-toggle" id="csvToggle">−</button>
                           
                            <div style="margin-top: 12px; display: flex; gap: 12px; flex-wrap: wrap; justify-content: center;">
                                <div class="file-upload">
                                    <input type="file" id="csvFile" accept=".csv,.txt">
                                    <label for="csvFile" class="file-upload-label">
                                        📁 Upload CSV
                                    </label>
                                </div>
                                <button class="btn btn-secondary" id="clearCsvBtn">🗑️ Clear Data</button>
                            </div>
                           
                            <div class="csv-example">
                                <strong>💡 Quick Examples:</strong><br>
                                <code style="background: rgba(0,0,0,0.3); padding: 2px 6px; border-radius: 4px; font-size: 11px;">image_url,Title,Detail</code> - Full content<br>
                                <code style="background: rgba(0,0,0,0.3); padding: 2px 6px; border-radius: 4px; font-size: 11px;">image_url,Title,</code> - Title only<br>
                                <code style="background: rgba(0,0,0,0.3); padding: 2px 6px; border-radius: 4px; font-size: 11px;">image_url,,Detail</code> - Detail only<br>
                                <code style="background: rgba(0,0,0,0.3); padding: 2px 6px; border-radius: 4px; font-size: 11px;">image_url,,</code> - Image only
                            </div>
                        </div>
                    </div>
                    <div class="preset-section">
                        <h3>🎯 Platform Presets</h3>
                        <div style="display: flex; gap: 12px; flex-wrap: wrap; justify-content: center;">
                            <button class="preset-btn preset-instagram" onclick="applyPreset('instagram')" title="Instagram-optimized settings">
                                📱 Instagram
                            </button>
                            <button class="preset-btn preset-youtube" onclick="applyPreset('youtube')" title="YouTube-optimized settings">
                                📺 YouTube
                            </button>
                            <button class="preset-btn preset-tiktok" onclick="applyPreset('tiktok')" title="TikTok-optimized settings">
                                🎵 TikTok
                            </button>
                            <button class="preset-btn preset-twitter" onclick="applyPreset('twitter')" title="Twitter-optimized settings">
                                🐦 Twitter
                            </button>
                            <button class="preset-btn preset-linkedin" onclick="applyPreset('linkedin')" title="LinkedIn-optimized settings">
                                💼 LinkedIn
                            </button>
                        </div>
                    </div>
                    <div class="control-group">
                        <h3>⚙️ Export Settings</h3>
                        <div class="control-grid">
                            <div>
                                <label>📐 Output Format</label>
                                <select id="outputSize">
                                    <option value="reel">📱 1080×1920 (Reels/Stories)</option>
                                    <option value="youtube">📺 1920×1080 (YouTube)</option>
                                    <option value="square">⬜ 1080×1080 (Instagram Square)</option>
                                    <option value="portrait">📖 1080×1350 (Portrait)</option>
                                    <option value="landscape">🌅 1350×1080 (Landscape)</option>
                                    <option value="original">📐 Original Size</option>
                                </select>
                            </div>
                            <div>
                                <label>🎨 Quality</label>
                                <select id="outputQuality">
                                    <option value="1.0">✨ Highest (1.0)</option>
                                    <option value="0.95">⚡ High (0.95)</option>
                                    <option value="0.9">🚀 Fast (0.9)</option>
                                    <option value="0.8">⚡ Fastest (0.8)</option>
                                </select>
                            </div>
                            <div>
                                <label>📁 Custom Font</label>
                                <input type="text" id="customFont" placeholder="'Custom Font Name', Arial, sans-serif">
                            </div>
                            <div>
                                <label>🏷️ File Prefix</label>
                                <input type="text" id="filePrefix" placeholder="my-graphics" value="overlay">
                            </div>
                        </div>
                    </div>
                   
                    <div class="btn-group">
                        <button class="btn btn-primary" id="singleBtn">
                            <span>✨</span> Generate Single
                        </button>
                        <button class="btn btn-primary" id="generateBtn">
                            <span>🚀</span> Generate All (<span id="itemCount">0</span>)
                        </button>
                        <button class="btn btn-secondary" id="exportZipBtn">
                            <span>📦</span> Export ZIP Pack
                        </button>
                        <button class="btn btn-danger" id="clearBtn">
                            <span>🗑️</span> Clear Results
                        </button>
                        <button class="btn btn-secondary" id="resetBtn">
                            <span>🔄</span> Reset All Settings
                        </button>
                    </div>
                   
                    <div class="progress-container">
                        <div class="progress-bar" id="progressBar"></div>
                    </div>
                    <div class="status-text" id="statusText">
                        🎯 Ready to create amazing graphics! Drag & drop CSV or paste data above
                    </div>
                </div>
                <!-- Title Tab -->
                <div id="title-tab" class="tab-content">
                    <div class="control-group">
                        <h3>🎨 Title Typography</h3>
                        <div class="control-grid">
                            <div>
                                <label>📏 Size</label>
                                <div class="slider-container">
                                    <input type="range" id="titleSize" min="12" max="200" value="60">
                                    <span class="slider-value" id="titleSizeValue">60px</span>
                                </div>
                                <label>🎨 Text Color</label>
                                <input type="color" id="titleColor" value="#ffffff">
                                <label>✨ Glow Color</label>
                                <input type="color" id="titleGlowColor" value="#ff6b6b">
                            </div>
                            <div>
                                <label>🌟 Glow Intensity</label>
                                <div class="slider-container">
                                    <input type="range" id="titleShadowBlur" min="0" max="50" value="20">
                                    <span class="slider-value" id="titleShadowBlurValue">20px</span>
                                </div>
                                <label>🎀 Font Family</label>
                                <select id="titleFontFamily">
                                    <option value="Playfair Display">✨ Playfair Display</option>
                                    <option value="Bebas Neue">⚡ Bebas Neue</option>
                                    <option value="Oswald">📢 Oswald</option>
                                    <option value="Rajdhani">⚙️ Rajdhani</option>
                                    <option value="Dancing Script">💌 Dancing Script</option>
                                    <option value="Great Vibes">🌹 Great Vibes</option>
                                    <option value="Inter">📝 Inter</option>
                                    <option value="Roboto Slab">📚 Roboto Slab</option>
                                    <option value="Montserrat">🛡️ Montserrat</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    <div class="control-group">
                        <h3>📐 Title Layout</h3>
                        <div class="control-grid">
                            <div>
                                <label>📍 Position</label>
                                <div class="slider-container">
                                    <input type="range" id="titleSlider" min="-300" max="500" value="0">
                                    <span class="slider-value" id="titleSliderValue">0px</span>
                                </div>
                                <label>📐 Alignment</label>
                                <select id="titleAlign">
                                    <option value="center">↔️ Center</option>
                                    <option value="left">⬅️ Left</option>
                                    <option value="right">➡️ Right</option>
                                </select>
                            </div>
                            <div>
                                <label>🖋️ Stroke Color</label>
                                <input type="color" id="titleBorderColor" value="#ffffff">
                                <label>📏 Stroke Width</label>
                                <div class="slider-container">
                                    <input type="range" id="titleBorderWidth" min="0" max="10" value="2">
                                    <span class="slider-value" id="titleBorderWidthValue">2px</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="control-group">
                        <h3>🎨 Title Background</h3>
                        <div class="control-grid">
                            <div>
                                <label>🎨 Gradient Start</label>
                                <input type="color" id="titleBg1" value="#00000080">
                                <label>🎨 Gradient End</label>
                                <input type="color" id="titleBg2" value="#00000040">
                                <label>🌫️ Opacity</label>
                                <div class="slider-container">
                                    <input type="range" id="titleBgOpacity" min="0" max="100" value="80">
                                    <span class="slider-value" id="titleBgOpacityValue">80%</span>
                                </div>
                            </div>
                            <div>
                                <label>🔄 Corner Radius</label>
                                <div class="slider-container">
                                    <input type="range" id="titleCornerRadius" min="0" max="40" value="20">
                                    <span class="slider-value" id="titleCornerRadiusValue">20px</span>
                                </div>
                                <label>📏 Padding</label>
                                <div class="slider-container">
                                    <input type="range" id="titlePadding" min="5" max="30" value="15">
                                    <span class="slider-value" id="titlePaddingValue">15px</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- Detail Tab -->
                <div id="detail-tab" class="tab-content">
                    <div class="control-group">
                        <h3>📝 Detail Typography</h3>
                        <div class="control-grid">
                            <div>
                                <label>📏 Size</label>
                                <div class="slider-container">
                                    <input type="range" id="detailSize" min="8" max="80" value="24">
                                    <span class="slider-value" id="detailSizeValue">24px</span>
                                </div>
                                <label>🎨 Text Color</label>
                                <input type="color" id="detailColor" value="#f8fafc">
                                <label>✨ Glow Color</label>
                                <input type="color" id="detailGlowColor" value="#4f46e5">
                            </div>
                            <div>
                                <label>🌟 Glow Intensity</label>
                                <div class="slider-container">
                                    <input type="range" id="detailShadowBlur" min="0" max="30" value="10">
                                    <span class="slider-value" id="detailShadowBlurValue">10px</span>
                                </div>
                                <label>🎀 Font Family</label>
                                <select id="detailFontFamily">
                                    <option value="Inter">📝 Inter (Modern)</option>
                                    <option value="Lora">📚 Lora (Readable)</option>
                                    <option value="Poppins">🛡️ Poppins (Clean)</option>
                                    <option value="Montserrat">⚡ Montserrat</option>
                                    <option value="Rajdhani">⚙️ Rajdhani (Tech)</option>
                                    <option value="Roboto Slab">📖 Roboto Slab</option>
                                    <option value="Oswald">📢 Oswald (Bold)</option>
                                    <option value="Segoe UI">💼 System Default</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    <div class="control-group">
                        <h3>📐 Detail Layout</h3>
                        <div class="control-grid">
                            <div>
                                <label>📍 Position</label>
                                <div class="slider-container">
                                    <input type="range" id="detailSlider" min="-300" max="500" value="0">
                                    <span class="slider-value" id="detailSliderValue">0px</span>
                                </div>
                                <label>📐 Alignment</label>
                                <select id="detailAlign">
                                    <option value="center">↔️ Center</option>
                                    <option value="left">⬅️ Left</option>
                                    <option value="right">➡️ Right</option>
                                </select>
                                <label>📏 Line Height</label>
                                <div class="slider-container">
                                    <input type="range" id="detailLineHeight" min="0.8" max="2.0" step="0.1" value="1.4">
                                    <span class="slider-value" id="detailLineHeightValue">1.4x</span>
                                </div>
                            </div>
                            <div>
                                <label>🖋️ Stroke Color</label>
                                <input type="color" id="detailBorderColor" value="#e2e8f0">
                                <label>📏 Stroke Width</label>
                                <div class="slider-container">
                                    <input type="range" id="detailBorderWidth" min="0" max="8" value="1">
                                    <span class="slider-value" id="detailBorderWidthValue">1px</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="control-group">
                        <h3>🎨 Detail Background</h3>
                        <div class="control-grid">
                            <div>
                                <label>🎨 Gradient Start</label>
                                <input type="color" id="detailBg1" value="#00000040">
                                <label>🎨 Gradient End</label>
                                <input type="color" id="detailBg2" value="#00000020">
                                <label>🌫️ Opacity</label>
                                <div class="slider-container">
                                    <input type="range" id="detailBgOpacity" min="0" max="100" value="70">
                                    <span class="slider-value" id="detailBgOpacityValue">70%</span>
                                </div>
                            </div>
                            <div>
                                <label>🔄 Corner Radius</label>
                                <div class="slider-container">
                                    <input type="range" id="detailCornerRadius" min="0" max="25" value="12">
                                    <span class="slider-value" id="detailCornerRadiusValue">12px</span>
                                </div>
                                <label>📏 Padding</label>
                                <div class="slider-container">
                                    <input type="range" id="detailPadding" min="3" max="25" value="10">
                                    <span class="slider-value" id="detailPaddingValue">10px</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="panel results-panel" id="resultsPanel" style="width: 100%; max-width: 1200px; margin-top: 24px; display: none;">
            <h2>🎉 Generated Graphics <span id="resultsCount" style="font-size: 14px; color: var(--text-secondary-dark);">(0)</span></h2>
            <div id="results" class="results"></div>
            <div style="text-align: center; margin-top: 24px; padding: 16px; background: rgba(16, 185, 129, 0.1); border-radius: 12px;">
                <strong>✅ All graphics match your preview exactly!</strong><br>
                <small style="color: var(--text-secondary-dark);">Files are optimized for web & social media</small>
            </div>
        </div>
    </div>
    <button id="themeToggle">🌙</button>
    <button id="goToTop">↑</button>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
   
    <script>
        // Wait for DOM to be fully loaded
        document.addEventListener('DOMContentLoaded', function() {
            // Professional Constants
            const DEFAULT_SETTINGS = {
                // Title Settings
                titleSize: 60, titleColor: '#ffffff', titleGlowColor: '#ff6b6b', titleShadowBlur: 20,
                titleBg1: '#00000080', titleBg2: '#00000040', titleBgOpacity: 80, titleBorderColor: '#ffffff',
                titleBorderWidth: 2, titleCornerRadius: 20, titlePadding: 15, titleSlider: 0, titleAlign: 'center',
                titleFontFamily: 'Playfair Display',
               
                // Detail Settings
                detailSize: 24, detailColor: '#f8fafc', detailGlowColor: '#4f46e5', detailShadowBlur: 10,
                detailBg1: '#00000040', detailBg2: '#00000020', detailBgOpacity: 70, detailBorderColor: '#e2e8f0',
                detailBorderWidth: 1, detailCornerRadius: 12, detailPadding: 10, detailSlider: 0,
                detailAlign: 'center', detailLineHeight: 1.4, detailFontFamily: 'Inter',
               
                // Global Settings
                customFont: '', outputSize: 'reel', outputQuality: 1.0, filePrefix: 'overlay'
            };
            const SIZE_PRESETS = {
                reel: [1080, 1920], youtube: [1920, 1080], square: [1080, 1080],
                portrait: [1080, 1350], landscape: [1350, 1080]
            };
            const MAX_PREVIEW_SIZE = 600;
            const DEBOUNCE_DELAY = 150;
            
            // DOM Elements - Now properly initialized after DOM load
            const elements = {
                previewCanvas: document.getElementById('previewCanvas'),
                results: document.getElementById('results'),
                resultsPanel: document.getElementById('resultsPanel'),
                resultsCount: document.getElementById('resultsCount'),
                progressBar: document.getElementById('progressBar'),
                statusText: document.getElementById('statusText'),
                previewInfo: document.getElementById('previewInfo'),
                previewDimensions: document.getElementById('previewDimensions'),
                csvInput: document.getElementById('csvInput'),
                csvFile: document.getElementById('csvFile'),
                csvDropZone: document.getElementById('csvDropZone'),
                itemCount: document.getElementById('itemCount'),
                clearCsvBtn: document.getElementById('clearCsvBtn'),
                inputs: document.querySelectorAll('input, select, textarea'),
                buttons: {
                    single: document.getElementById('singleBtn'),
                    generate: document.getElementById('generateBtn'),
                    clear: document.getElementById('clearBtn'),
                    reset: document.getElementById('resetBtn'),
                    exportZip: document.getElementById('exportZipBtn')
                }
            };
            
            const ctx = elements.previewCanvas.getContext('2d');
            const themeToggle = document.getElementById('themeToggle');
            const goToTop = document.getElementById('goToTop');
            const csvToggle = document.getElementById('csvToggle');
            
            // State
            const imageCache = new Map();
            let isCsvMinimized = false;
            let currentPreviewData = null;
            
            // Make functions globally accessible
            window.applyPreset = applyPreset;
            window.scrollToResults = scrollToResults;
            window.setAsPreview = setAsPreview;
            window.shareImage = shareImage;
            window.exportBatch = exportBatch;
            
            // Enhanced Tab System
            const tabButtons = document.querySelectorAll('.tab-btn');
            const tabContents = document.querySelectorAll('.tab-content');
            
            function switchTab(tabName) {
                tabButtons.forEach(btn => btn.classList.remove('active'));
                document.querySelector(`[data-tab="${tabName}"]`).classList.add('active');
                tabContents.forEach(content => content.classList.remove('active'));
                document.getElementById(`${tabName}-tab`).classList.add('active');
                updateItemCount();
            }
            
            // FIXED CSV Toggle
            function toggleCsv() {
                isCsvMinimized = !isCsvMinimized;
                const csvInput = elements.csvInput;
               
                if (isCsvMinimized) {
                    csvInput.classList.add('minimized');
                    csvToggle.textContent = '+';
                    csvToggle.classList.add('minimized');
                } else {
                    csvInput.classList.remove('minimized');
                    csvToggle.textContent = '−';
                    csvToggle.classList.remove('minimized');
                }
            }
            
            // FIXED File Upload - Proper event listener
            elements.csvFile.addEventListener('change', function(event) {
                loadCsvFile(event);
            });
            
            function loadCsvFile(event) {
                const file = event.target.files[0];
                if (!file) return;
               
                const reader = new FileReader();
                reader.onload = (e) => {
                    elements.csvInput.value = e.target.result;
                    updateItemCount();
                    updatePreview();
                    elements.statusText.innerHTML = `
                        ✅ <strong>Loaded:</strong> ${file.name}
                        <span style="color: #10b981;">(${getValidLineCount()} valid items)</span>
                    `;
                    elements.csvFile.value = ''; // Reset input
                };
                reader.onerror = () => {
                    elements.statusText.innerHTML = `❌ <strong>Error:</strong> Could not read file`;
                };
                reader.readAsText(file);
            }
            
            function clearCsv() {
                elements.csvInput.value = '';
                updateItemCount();
                elements.statusText.innerHTML = '🗑️ <strong>Cleared:</strong> Input data removed';
                elements.csvFile.value = '';
            }
            
            // Smart CSV Validation
            function validateCsvLine(line) {
                if (!line.trim()) return false;
                const parts = line.split(',').map(part => part.trim());
                return parts.length > 0 && parts[0] && parts[0].startsWith('http');
            }
            
            function parseCsvLine(line) {
                const parts = line.split(',').map(part => part.trim());
                while (parts.length < 3) parts.push('');
                return parts.slice(0, 3);
            }
            
            function getValidLineCount() {
                return elements.csvInput.value.trim().split('\n').filter(validateCsvLine).length;
            }
            
            function updateItemCount() {
                const count = getValidLineCount();
                elements.itemCount.textContent = count;
                elements.buttons.generate.disabled = count === 0;
            }
            
            // Professional Preset System
            const PRESETS = {
                instagram: {
                    outputSize: 'reel', outputQuality: 0.95,
                    titleSize: 72, titleColor: '#ffffff', titleGlowColor: '#ff6b6b', titleShadowBlur: 25,
                    titleFontFamily: 'Playfair Display', titleAlign: 'center', titleSlider: 50,
                    titleBg1: '#e4405f40', titleBg2: '#f7773740',
                    detailSize: 28, detailColor: '#ffffff', detailGlowColor: '#60a5fa', detailShadowBlur: 12,
                    detailFontFamily: 'Inter', detailAlign: 'center', detailSlider: 80,
                    detailBg1: '#e4405f20', detailBg2: '#f7773720',
                    titleBgOpacity: 90, detailBgOpacity: 85
                },
                youtube: {
                    outputSize: 'youtube', outputQuality: 1.0,
                    titleSize: 80, titleColor: '#ffffff', titleGlowColor: '#ff0000', titleShadowBlur: 30,
                    titleFontFamily: 'Bebas Neue', titleAlign: 'center', titleSlider: 30,
                    titleBg1: '#ff000040', titleBg2: '#cc000040',
                    detailSize: 32, detailColor: '#f3f4f6', detailGlowColor: '#3b82f6', detailShadowBlur: 15,
                    detailFontFamily: 'Inter', detailAlign: 'center', detailSlider: 60,
                    detailBg1: '#ff000020', detailBg2: '#cc000020',
                    titleBgOpacity: 75, detailBgOpacity: 70
                },
                tiktok: {
                    outputSize: 'reel', outputQuality: 0.9,
                    titleSize: 64, titleColor: '#000000', titleGlowColor: '#000000', titleShadowBlur: 15,
                    titleFontFamily: 'Oswald', titleAlign: 'center', titleSlider: 80,
                    titleBg1: '#ffffff40', titleBg2: '#f3f4f640',
                    detailSize: 22, detailColor: '#111827', detailGlowColor: '#111827', detailShadowBlur: 8,
                    detailFontFamily: 'Inter', detailAlign: 'center', detailSlider: 120,
                    detailBg1: '#ffffff20', detailBg2: '#f3f4f620',
                    titleBgOpacity: 25, detailBgOpacity: 30
                },
                twitter: {
                    outputSize: 'square', outputQuality: 0.95,
                    titleSize: 56, titleColor: '#ffffff', titleGlowColor: '#1da1f2', titleShadowBlur: 20,
                    titleFontFamily: 'Inter', titleAlign: 'center', titleSlider: 40,
                    titleBg1: '#1da1f240', titleBg2: '#0d8bd940',
                    detailSize: 20, detailColor: '#e1e8ed', detailGlowColor: '#1da1f2', detailShadowBlur: 10,
                    detailFontFamily: 'Inter', detailAlign: 'center', detailSlider: 80,
                    detailBg1: '#1da1f220', detailBg2: '#0d8bd920',
                    titleBgOpacity: 60, detailBgOpacity: 50
                },
                linkedin: {
                    outputSize: 'square', outputQuality: 1.0,
                    titleSize: 48, titleColor: '#ffffff', titleGlowColor: '#0077b5', titleShadowBlur: 18,
                    titleFontFamily: 'Roboto Slab', titleAlign: 'center', titleSlider: 30,
                    titleBg1: '#0077b540', titleBg2: '#00588540',
                    detailSize: 18, detailColor: '#f0f4f8', detailGlowColor: '#005885', detailShadowBlur: 8,
                    detailFontFamily: 'Inter', detailAlign: 'left', detailSlider: 70,
                    detailBg1: '#0077b520', detailBg2: '#00588520',
                    titleBgOpacity: 70, detailBgOpacity: 60
                }
            };
            
            function applyPreset(platform) {
                const preset = PRESETS[platform];
                if (!preset) return;
               
                Object.entries(preset).forEach(([key, value]) => {
                    const element = document.getElementById(key);
                    if (element) element.value = value;
                });
               
                updateSliderValues();
                updatePreview();
               
                const platformNames = {
                    instagram: 'Instagram', youtube: 'YouTube', tiktok: 'TikTok',
                    twitter: 'Twitter', linkedin: 'LinkedIn'
                };
               
                elements.statusText.innerHTML = `
                    🎯 <strong>Applied ${platformNames[platform]} Preset!</strong>
                    <span style="color: #10b981;">Optimized for ${platformNames[platform]} platform</span>
                `;
            }
            
            // Image Loading with Retry
            async function loadImage(src, retryCount = 0) {
                if (imageCache.has(src)) return imageCache.get(src);
               
                return new Promise((resolve, reject) => {
                    const img = new Image();
                    img.crossOrigin = 'anonymous';
                   
                    const timeout = setTimeout(() => {
                        reject(new Error('Image load timeout'));
                    }, 10000);
                   
                    img.onload = () => {
                        clearTimeout(timeout);
                        imageCache.set(src, img);
                        resolve(img);
                    };
                   
                    img.onerror = () => {
                        clearTimeout(timeout);
                        if (retryCount < 2) {
                            setTimeout(() => loadImage(src, retryCount + 1), 1000);
                        } else {
                            reject(new Error(`Failed to load image after ${retryCount + 1} attempts: ${src}`));
                        }
                    };
                   
                    img.src = src + (retryCount > 0 ? `?retry=${retryCount}` : '');
                });
            }
            
            // Enhanced Rounded Rectangle
            function drawRoundedRect(x, y, width, height, radius, ctx) {
                if (width < 2 * radius) radius = width / 2;
                if (height < 2 * radius) radius = height / 2;
               
                ctx.save();
                ctx.beginPath();
                ctx.moveTo(x + radius, y);
                ctx.arcTo(x + width, y, x + width, y + height, radius);
                ctx.arcTo(x + width, y + height, x, y + height, radius);
                ctx.arcTo(x, y + height, x, y, radius);
                ctx.arcTo(x, y, x + width, y, radius);
                ctx.closePath();
                ctx.restore();
            }
            
            // FIXED: Get All Settings - NO AUTOMATIC COLOR OVERRIDES
            function getSettings() {
                return {
                    // Title - Use user-selected colors directly
                    titleSize: parseFloat(document.getElementById('titleSize').value),
                    titleColor: document.getElementById('titleColor').value,
                    titleGlowColor: document.getElementById('titleGlowColor').value,
                    titleShadowBlur: parseFloat(document.getElementById('titleShadowBlur').value),
                    titleBg1: document.getElementById('titleBg1').value, // User selected
                    titleBg2: document.getElementById('titleBg2').value, // User selected
                    titleBgOpacity: parseFloat(document.getElementById('titleBgOpacity').value),
                    titleBorderColor: document.getElementById('titleBorderColor').value,
                    titleBorderWidth: parseFloat(document.getElementById('titleBorderWidth').value),
                    titleCornerRadius: parseFloat(document.getElementById('titleCornerRadius').value),
                    titlePadding: parseFloat(document.getElementById('titlePadding').value),
                    titleSlider: parseFloat(document.getElementById('titleSlider').value),
                    titleAlign: document.getElementById('titleAlign').value,
                    titleFontFamily: document.getElementById('titleFontFamily').value,
                   
                    // Detail - Use user-selected colors directly
                    detailSize: parseFloat(document.getElementById('detailSize').value),
                    detailColor: document.getElementById('detailColor').value, // User selected
                    detailGlowColor: document.getElementById('detailGlowColor').value,
                    detailShadowBlur: parseFloat(document.getElementById('detailShadowBlur').value),
                    detailBg1: document.getElementById('detailBg1').value, // User selected
                    detailBg2: document.getElementById('detailBg2').value, // User selected
                    detailBgOpacity: parseFloat(document.getElementById('detailBgOpacity').value),
                    detailBorderColor: document.getElementById('detailBorderColor').value,
                    detailBorderWidth: parseFloat(document.getElementById('detailBorderWidth').value),
                    detailCornerRadius: parseFloat(document.getElementById('detailCornerRadius').value),
                    detailPadding: parseFloat(document.getElementById('detailPadding').value),
                    detailSlider: parseFloat(document.getElementById('detailSlider').value),
                    detailAlign: document.getElementById('detailAlign').value,
                    detailLineHeight: parseFloat(document.getElementById('detailLineHeight').value),
                    detailFontFamily: document.getElementById('detailFontFamily').value,
                   
                    // Global
                    customFont: document.getElementById('customFont').value,
                    outputSize: document.getElementById('outputSize').value,
                    outputQuality: parseFloat(document.getElementById('outputQuality').value),
                    filePrefix: document.getElementById('filePrefix').value
                };
            }
            
            // FIXED: Professional Rendering Engine - Correct gradient application
            async function drawTextOverlay(img, title, detail, settings, canvas, scale = 1) {
                const ctx = canvas.getContext('2d');
               
                // Set dimensions
                const [targetW, targetH] = SIZE_PRESETS[settings.outputSize] || [img.width, img.height];
                canvas.width = targetW * scale;
                canvas.height = targetH * scale;
               
                // Clear canvas
                ctx.clearRect(0, 0, canvas.width, canvas.height);
               
                // Draw background image
                const targetRatio = targetW / targetH;
                const imgRatio = img.width / img.height;
                let sx = 0, sy = 0, sw = img.width, sh = img.height;
               
                if (imgRatio > targetRatio) {
                    // Crop sides
                    sw = img.height * targetRatio;
                    sx = (img.width - sw) / 2;
                } else {
                    // Crop top/bottom
                    sh = img.width / targetRatio;
                    sy = (img.height - sh) / 2;
                }
               
                ctx.imageSmoothingEnabled = true;
                ctx.imageSmoothingQuality = 'high';
                ctx.drawImage(img, sx, sy, sw, sh, 0, 0, canvas.width, canvas.height);
                
                const margin = 40 * scale;
                const fontFamily = settings.customFont ? `"${settings.customFont}", ` : '';
                const lineHeightMultiplier = settings.detailLineHeight || 1.4;
                
                // TITLE RENDERING - FIXED GRADIENT & COLOR
                if (title && title.trim()) {
                    ctx.save();
                    ctx.font = `bold ${settings.titleSize * scale}px ${fontFamily}${settings.titleFontFamily}, sans-serif`;
                    
                    // Measure text first for positioning
                    ctx.textAlign = 'center';
                    ctx.textBaseline = 'top';
                    const titleMetrics = ctx.measureText(title);
                    const titleWidth = titleMetrics.width;
                    const titleHeight = settings.titleSize * scale * 1.2;
                    
                    // Set proper alignment for drawing
                    ctx.textAlign = settings.titleAlign;
                    
                    // Calculate X position based on alignment
                    let titleX;
                    if (settings.titleAlign === 'left') {
                        titleX = margin;
                        ctx.textAlign = 'left';
                    } else if (settings.titleAlign === 'right') {
                        titleX = canvas.width - margin;
                        ctx.textAlign = 'right';
                    } else {
                        titleX = canvas.width / 2;
                        ctx.textAlign = 'center';
                    }
                    
                    const titleY = margin + settings.titleSlider * scale;
                    const padding = settings.titlePadding * scale;
                    const cornerRadius = settings.titleCornerRadius * scale;
                    const borderWidth = settings.titleBorderWidth * scale;
                    
                    // Calculate background position based on alignment
                    let bgX, bgWidth;
                    if (settings.titleAlign === 'center') {
                        bgX = titleX - titleWidth/2 - padding;
                        bgWidth = titleWidth + padding * 2;
                    } else if (settings.titleAlign === 'left') {
                        bgX = titleX + padding;
                        bgWidth = titleWidth + padding;
                    } else { // right
                        bgX = titleX - titleWidth - padding;
                        bgWidth = titleWidth + padding;
                    }
                    
                    // FIXED: Background with proper gradient
                    if (settings.titleBgOpacity > 0) {
                        // Create gradient from user's selected colors
                        const gradient = ctx.createLinearGradient(
                            bgX, titleY,
                            bgX + bgWidth, titleY + titleHeight
                        );
                        
                        // Parse the hex colors with alpha
                        const startColor = hexToRgba(settings.titleBg1, settings.titleBgOpacity / 100);
                        const endColor = hexToRgba(settings.titleBg2, settings.titleBgOpacity / 100);
                        
                        gradient.addColorStop(0, startColor);
                        gradient.addColorStop(1, endColor);
                       
                        ctx.save();
                        ctx.fillStyle = gradient;
                        drawRoundedRect(bgX, titleY, bgWidth, titleHeight, cornerRadius, ctx);
                        ctx.fill();
                        ctx.restore();
                    }
                    
                    // Border & Glow - Use user-selected colors
                    if (borderWidth > 0) {
                        ctx.strokeStyle = settings.titleBorderColor;
                        ctx.lineWidth = borderWidth;
                        ctx.shadowColor = settings.titleGlowColor;
                        ctx.shadowBlur = settings.titleShadowBlur * scale;
                        ctx.strokeText(title, titleX, titleY);
                    }
                    
                    // Text - Use user-selected color
                    ctx.shadowBlur = 0;
                    ctx.fillStyle = settings.titleColor;
                    ctx.fillText(title, titleX, titleY);
                    ctx.restore();
                }
                
                // DETAIL RENDERING - FIXED GRADIENT & MULTI-LINE
                if (detail && detail.trim()) {
                    const lines = detail.split('\n').filter(line => line.trim());
                    if (lines.length > 0) {
                        ctx.save();
                        const lineHeight = settings.detailSize * scale * lineHeightMultiplier;
                        
                        lines.forEach((line, i) => {
                            // Measure each line
                            ctx.font = `${settings.detailSize * scale}px ${fontFamily}${settings.detailFontFamily}, sans-serif`;
                            ctx.textAlign = 'center';
                            const textMetrics = ctx.measureText(line);
                            const textWidth = textMetrics.width;
                            
                            // Set proper alignment for drawing
                            ctx.textAlign = settings.detailAlign;
                            
                            // Calculate X position based on alignment
                            let detailX;
                            if (settings.detailAlign === 'left') {
                                detailX = margin;
                                ctx.textAlign = 'left';
                            } else if (settings.detailAlign === 'right') {
                                detailX = canvas.width - margin;
                                ctx.textAlign = 'right';
                            } else {
                                detailX = canvas.width / 2;
                                ctx.textAlign = 'center';
                            }
                            
                            const lineY = canvas.height - (lines.length - i) * lineHeight - margin - settings.detailSlider * scale;
                            const padding = settings.detailPadding * scale;
                            const cornerRadius = settings.detailCornerRadius * scale;
                            const borderWidth = settings.detailBorderWidth * scale;
                            const textHeight = settings.detailSize * scale * lineHeightMultiplier;
                            
                            // Calculate background position for each line
                            let bgX, bgWidth;
                            if (settings.detailAlign === 'center') {
                                bgX = detailX - textWidth/2 - padding;
                                bgWidth = textWidth + padding * 2;
                            } else if (settings.detailAlign === 'left') {
                                bgX = detailX + padding;
                                bgWidth = textWidth + padding;
                            } else { // right
                                bgX = detailX - textWidth - padding;
                                bgWidth = textWidth + padding;
                            }
                            
                            // FIXED: Background with proper gradient for each line
                            if (settings.detailBgOpacity > 0) {
                                const gradient = ctx.createLinearGradient(
                                    bgX, lineY,
                                    bgX + bgWidth, lineY + textHeight
                                );
                                
                                // Parse the hex colors with alpha for detail
                                const startColor = hexToRgba(settings.detailBg1, settings.detailBgOpacity / 100);
                                const endColor = hexToRgba(settings.detailBg2, settings.detailBgOpacity / 100);
                                
                                gradient.addColorStop(0, startColor);
                                gradient.addColorStop(1, endColor);
                               
                                ctx.save();
                                ctx.fillStyle = gradient;
                                drawRoundedRect(bgX, lineY, bgWidth, textHeight, cornerRadius, ctx);
                                ctx.fill();
                                ctx.restore();
                            }
                            
                            // Border & Glow for each line
                            if (borderWidth > 0) {
                                ctx.strokeStyle = settings.detailBorderColor;
                                ctx.lineWidth = borderWidth;
                                ctx.shadowColor = settings.detailGlowColor;
                                ctx.shadowBlur = settings.detailShadowBlur * scale;
                                ctx.strokeText(line, detailX, lineY);
                            }
                            
                            // Text for each line - Use user-selected color
                            ctx.shadowBlur = 0;
                            ctx.fillStyle = settings.detailColor;
                            ctx.fillText(line, detailX, lineY);
                        });
                        ctx.restore();
                    }
                }
                
                // Update preview info
                if (scale === 1) {
                    elements.previewDimensions.textContent = `${targetW}×${targetH}px`;
                }
                return canvas.toDataURL('image/png', settings.outputQuality);
            }
            
            // FIXED: Hex to RGBA conversion for proper gradient transparency
            function hexToRgba(hex, alpha) {
                const r = parseInt(hex.slice(1, 3), 16);
                const g = parseInt(hex.slice(3, 5), 16);
                const b = parseInt(hex.slice(5, 7), 16);
                return `rgba(${r}, ${g}, ${b}, ${alpha})`;
            }
            
            // Enhanced Slider Updates
            function updateSliderValues() {
                const sliders = {
                    titleSize: 'px', detailSize: 'px', titleShadowBlur: 'px', detailShadowBlur: 'px',
                    titleSlider: 'px', detailSlider: 'px', titleBgOpacity: '%', detailBgOpacity: '%',
                    titleBorderWidth: 'px', detailBorderWidth: 'px', titleCornerRadius: 'px',
                    detailCornerRadius: 'px', titlePadding: 'px', detailPadding: 'px',
                    detailLineHeight: 'x'
                };
               
                Object.entries(sliders).forEach(([id, unit]) => {
                    const slider = document.getElementById(id);
                    const display = document.getElementById(`${id}Value`);
                    if (slider && display) {
                        const value = slider.value;
                        display.textContent = unit === 'x' ? `${value}x` : `${value}${unit}`;
                    }
                });
            }
            
            // Debounced Preview
            function debounce(func, wait) {
                let timeout;
                return function executedFunction(...args) {
                    const later = () => {
                        clearTimeout(timeout);
                        func(...args);
                    };
                    clearTimeout(timeout);
                    timeout = setTimeout(later, wait);
                };
            }
            
            const updatePreview = debounce(async () => {
                const settings = getSettings();
                const csvLines = elements.csvInput.value.trim().split('\n').filter(validateCsvLine);
               
                if (!csvLines.length) {
                    elements.statusText.innerHTML = `
                        📝 <strong>No Content</strong> -
                        <a href="#" onclick="document.getElementById('csvInput').focus(); return false;"
                           style="color: #3b82f6;">Paste CSV data</a> or
                        <a href="#" onclick="document.getElementById('csvFile').click(); return false;"
                           style="color: #3b82f6;">upload a file</a>
                    `;
                    return;
                }
                const [src, title, detail] = parseCsvLine(csvLines[0]);
                const contentType = title.trim() && detail.trim() ? 'Title + Detail' :
                                  title.trim() ? 'Title Only' :
                                  detail.trim() ? 'Detail Only' : 'Image Only';
               
                try {
                    elements.statusText.innerHTML = `
                        ⏳ <strong>Rendering Preview...</strong>
                        <span class="loading"></span> ${contentType}
                    `;
                   
                    const img = await loadImage(src);
                    const [targetW, targetH] = SIZE_PRESETS[settings.outputSize] || [img.width, img.height];
                   
                    const scale = Math.min(MAX_PREVIEW_SIZE / Math.max(targetW, targetH), 1);
                    const previewW = targetW * scale;
                    const previewH = targetH * scale;
                   
                    elements.previewCanvas.width = previewW;
                    elements.previewCanvas.height = previewH;
                   
                    const dataUrl = await drawTextOverlay(img, title, detail, settings, elements.previewCanvas, scale);
                    currentPreviewData = dataUrl;
                   
                    elements.previewInfo.innerHTML = `
                        <div>${contentType}</div>
                        <div>${targetW}×${targetH}px</div>
                    `;
                   
                    elements.statusText.classList.add('success');
                    setTimeout(() => elements.statusText.classList.remove('success'), 600);
                   
                    elements.statusText.innerHTML = `
                        ✅ <strong>Live Preview Ready</strong> |
                        ${contentType} | ${targetW}×${targetH} |
                        <span style="color: #10b981;">✓ Export matches exactly</span>
                    `;
                   
                } catch (error) {
                    elements.statusText.innerHTML = `
                        ❌ <strong>Preview Error:</strong> ${error.message}
                        <br><small style="color: var(--text-secondary-dark);">Check your image URL</small>
                    `;
                }
            }, DEBOUNCE_DELAY);
            
            // Button State Management
            function disableButtons(disabled) {
                Object.values(elements.buttons).forEach(btn => {
                    if (btn) btn.disabled = disabled;
                });
                elements.buttons.generate.disabled = disabled || getValidLineCount() === 0;
            }
            
            // Generate Single
            async function generateSingle() {
                const csvLines = elements.csvInput.value.trim().split('\n').filter(validateCsvLine);
                if (!csvLines.length) {
                    elements.statusText.innerHTML = '📝 <strong>No data</strong> - Please add CSV content first';
                    return;
                }
               
                disableButtons(true);
                const settings = getSettings();
                const [src, title, detail] = parseCsvLine(csvLines[0]);
                const contentType = title.trim() && detail.trim() ? 'Full Content' :
                                  title.trim() ? 'Title Only' : detail.trim() ? 'Detail Only' : 'Image Only';
                const timestamp = new Date().toISOString().slice(0, 19).replace(/[:.]/g, '-');
               
                try {
                    elements.statusText.innerHTML = `
                        ✨ <strong>Creating Professional Graphic...</strong>
                        <br><small>${contentType} • ${SIZE_PRESETS[settings.outputSize]?.join('×') || 'Original'}px</small>
                        <div style="margin-top: 8px;"><span class="loading"></span></div>
                    `;
                   
                    const img = await loadImage(src);
                    const canvas = document.createElement('canvas');
                    const dataUrl = await drawTextOverlay(img, title, detail, settings, canvas, 1);
                   
                    const filename = `${settings.filePrefix || 'overlay'}_${contentType.toLowerCase().replace(/\s+/g, '_')}_${timestamp}.png`;
                   
                    // Show results panel
                    elements.resultsPanel.style.display = 'block';
                    elements.results.innerHTML = `
                        <div class="result-item success">
                            <div class="result-meta">
                                <strong>✨ ${contentType}</strong> •
                                ${SIZE_PRESETS[settings.outputSize]?.join('×') || `${img.width}×${img.height}`}px •
                                Generated: ${new Date().toLocaleTimeString()}
                            </div>
                            <img src="${dataUrl}" alt="Professional Graphic" loading="lazy">
                            <div style="margin: 16px 0; display: flex; gap: 12px; flex-wrap: wrap; justify-content: center;">
                                <a class="btn btn-primary" href="${dataUrl}" download="${filename}">💾 Download PNG</a>
                                <button class="btn btn-secondary" onclick="shareImage('${dataUrl}', '${filename}')">📤 Share</button>
                                <button class="btn btn-warning" onclick="setAsPreview('${dataUrl}')">👁️ Set as Preview</button>
                            </div>
                        </div>
                    `;
                   
                    elements.resultsCount.textContent = `(1)`;
                    elements.statusText.innerHTML = `
                        🎉 <strong>Success!</strong> Professional ${contentType.toLowerCase()} graphic created
                        <br><small><a href="#" onclick="scrollToResults()" style="color: #3b82f6;">👇 View Result</a></small>
                    `;
                   
                    // Scroll to results
                    scrollToResults();
                   
                } catch (error) {
                    elements.statusText.innerHTML = `
                        ❌ <strong>Generation Failed:</strong> ${error.message}
                        <br><small style="color: var(--text-secondary-dark);">Please check your image URL and try again</small>
                    `;
                } finally {
                    disableButtons(false);
                }
            }
            
            // Generate All
            async function generateAll() {
                const csvLines = elements.csvInput.value.trim().split('\n').filter(validateCsvLine);
                if (!csvLines.length) return;
               
                disableButtons(true);
                elements.resultsPanel.style.display = 'block';
                elements.results.innerHTML = '';
                const settings = getSettings();
                const timestamp = new Date().toISOString().slice(0, 10);
               
                elements.statusText.innerHTML = `
                    🚀 <strong>Batch Processing</strong> ${csvLines.length} graphics...
                    <div style="margin-top: 8px;"><span class="loading"></span></div>
                `;
               
                let successCount = 0;
                const results = [];
               
                for (let i = 0; i < csvLines.length; i++) {
                    const [src, title, detail] = parseCsvLine(csvLines[i]);
                    const contentType = title.trim() && detail.trim() ? 'Full' :
                                      title.trim() ? 'Title' : detail.trim() ? 'Detail' : 'Image';
                    const progress = ((i + 1) / csvLines.length) * 100;
                   
                    elements.progressBar.style.width = `${progress}%`;
                    elements.statusText.innerHTML = `
                        🚀 <strong>Processing ${i + 1}/${csvLines.length}</strong> - ${contentType}
                        <div style="margin-top: 8px; font-size: 12px; color: var(--text-secondary-dark);">
                            ${Math.round(progress)}% • ${src.substring(0, 40)}...
                        </div>
                    `;
                   
                    try {
                        const img = await loadImage(src);
                        const canvas = document.createElement('canvas');
                        const dataUrl = await drawTextOverlay(img, title, detail, settings, canvas, 1);
                       
                        const filename = `${settings.filePrefix || 'overlay'}_${i + 1}_${contentType.toLowerCase()}_${timestamp}.png`;
                       
                        const resultDiv = document.createElement('div');
                        resultDiv.className = 'result-item';
                        resultDiv.innerHTML = `
                            <div class="result-meta">
                                <strong>${contentType} #${i + 1}</strong> •
                                ${SIZE_PRESETS[settings.outputSize]?.join('×') || `${img.width}×${img.height}`}px
                            </div>
                            <img src="${dataUrl}" alt="Graphic ${i + 1}" loading="lazy">
                            <div style="margin: 16px 0; display: flex; gap: 8px; flex-wrap: wrap; justify-content: center;">
                                <a class="btn btn-primary" href="${dataUrl}" download="${filename}">💾 Download</a>
                                <button class="btn btn-secondary" onclick="shareImage('${dataUrl}', '${filename}')">📤 Share</button>
                                <button class="btn btn-warning" onclick="setAsPreview('${dataUrl}')">👁️ Preview</button>
                            </div>
                        `;
                       
                        results.push({ element: resultDiv, dataUrl, filename });
                        elements.results.appendChild(resultDiv);
                        successCount++;
                       
                    } catch (error) {
                        console.error(`Failed to generate ${i + 1}:`, error);
                        const errorDiv = document.createElement('div');
                        errorDiv.className = 'result-item';
                        errorDiv.style.borderLeft = '4px solid #ef4444';
                        errorDiv.innerHTML = `
                            <div class="result-meta" style="color: #ef4444;">
                                <strong>❌ Failed #${i + 1}</strong> • Image Load Error
                            </div>
                            <div style="color: var(--text-secondary-dark); font-size: 12px;">${error.message}</div>
                        `;
                        elements.results.appendChild(errorDiv);
                    }
                }
               
                elements.resultsCount.textContent = `(${successCount})`;
                elements.progressBar.style.width = '100%';
               
                elements.statusText.innerHTML = `
                    🎉 <strong>Batch Complete!</strong> Generated ${successCount}/${csvLines.length} graphics successfully
                    <br><small><a href="#" onclick="scrollToResults()" style="color: #3b82f6;">👇 View All Results</a> |
                    <a href="#" onclick="exportBatch(${JSON.stringify(results)})" style="color: #10b981;">📦 Export All</a></small>
                `;
               
                scrollToResults();
                disableButtons(false);
            }
            
            // Enhanced Export
            async function exportAsZip() {
                const csvLines = elements.csvInput.value.trim().split('\n').filter(validateCsvLine);
                if (!csvLines.length) return;
               
                disableButtons(true);
                const zip = new JSZip();
                const settings = getSettings();
                const timestamp = new Date().toISOString().slice(0, 19).replace(/[:.]/g, '-');
                const packName = `${settings.filePrefix || 'graphics'}_pack_${timestamp}`;
               
                elements.statusText.innerHTML = `
                    📦 <strong>Creating Professional ZIP Pack...</strong>
                    <div style="margin-top: 8px;"><span class="loading"></span></div>
                `;
               
                let successCount = 0;
               
                for (let i = 0; i < csvLines.length; i++) {
                    const progress = ((i + 1) / csvLines.length) * 100;
                    elements.progressBar.style.width = `${progress}%`;
                   
                    const [src, title, detail] = parseCsvLine(csvLines[i]);
                    const contentType = title.trim() && detail.trim() ? 'full' :
                                      title.trim() ? 'title' : detail.trim() ? 'detail' : 'image';
                   
                    try {
                        const img = await loadImage(src);
                        const canvas = document.createElement('canvas');
                        const dataUrl = await drawTextOverlay(img, title, detail, settings, canvas, 1);
                        const base64Data = dataUrl.split(',')[1];
                       
                        const filename = `${settings.filePrefix || 'overlay'}_${i + 1}_${contentType}_${timestamp}.png`;
                        zip.file(filename, base64Data, { base64: true });
                       
                        // Add preview thumbnail
                        if (i === 0) {
                            zip.file('preview.png', base64Data, { base64: true });
                        }
                       
                        successCount++;
                       
                    } catch (error) {
                        console.error(`Failed to add ${i + 1} to ZIP:`, error);
                    }
                }
               
                // Add settings file
                zip.file('settings.json', JSON.stringify({
                    generated: new Date().toISOString(),
                    count: successCount,
                    settings: settings,
                    platform: settings.outputSize
                }, null, 2));
               
                // Generate ZIP
                try {
                    const content = await zip.generateAsync({ type: 'blob' });
                    saveAs(content, `${packName}.zip`);
                   
                    elements.progressBar.style.width = '100%';
                    elements.statusText.innerHTML = `
                        📦 <strong>ZIP Pack Ready!</strong> ${successCount} professional graphics exported
                        <br><small>Downloaded: <strong>${packName}.zip</strong> (includes settings & preview)</small>
                    `;
                } catch (error) {
                    elements.statusText.innerHTML = `
                        ❌ <strong>Export Failed:</strong> ${error.message}
                        <br><small style="color: var(--text-secondary-dark);">Please try again</small>
                    `;
                }
               
                disableButtons(false);
            }
            
            // Utility Functions
            function scrollToResults() {
                elements.resultsPanel.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }
            
            function setAsPreview(dataUrl) {
                // Create a temporary canvas to display the image
                const tempCanvas = document.createElement('canvas');
                const tempCtx = tempCanvas.getContext('2d');
                const img = new Image();
                img.onload = () => {
                    tempCanvas.width = img.width;
                    tempCanvas.height = img.height;
                    tempCtx.drawImage(img, 0, 0);
                    elements.previewCanvas.width = Math.min(img.width, MAX_PREVIEW_SIZE);
                    elements.previewCanvas.height = (img.height * elements.previewCanvas.width) / img.width;
                    elements.previewCanvas.getContext('2d').drawImage(tempCanvas, 0, 0, elements.previewCanvas.width, elements.previewCanvas.height);
                    currentPreviewData = elements.previewCanvas.toDataURL();
                    elements.statusText.innerHTML = '👁️ <strong>Preview Updated</strong> - Using generated graphic';
                };
                img.src = dataUrl;
            }
            
            async function shareImage(dataUrl, filename) {
                if (navigator.share && navigator.canShare && navigator.canShare({ files: [] })) {
                    try {
                        const response = await fetch(dataUrl);
                        const blob = await response.blob();
                        const file = new File([blob], filename, { type: 'image/png' });
                       
                        if (navigator.canShare({ files: [file] })) {
                            await navigator.share({
                                files: [file],
                                title: 'Professional Graphic',
                                text: 'Check out this amazing graphic I created!'
                            });
                            elements.statusText.innerHTML = '📤 <strong>Shared Successfully!</strong>';
                        } else {
                            downloadImage(dataUrl, filename);
                        }
                    } catch (error) {
                        console.warn('Share failed:', error);
                        downloadImage(dataUrl, filename);
                    }
                } else {
                    downloadImage(dataUrl, filename);
                }
            }
            
            function downloadImage(dataUrl, filename) {
                const link = document.createElement('a');
                link.href = dataUrl;
                link.download = filename;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            }
            
            function exportBatch(results) {
                if (!results || results.length === 0) return;
               
                const zip = new JSZip();
                results.forEach((result) => {
                    const base64Data = result.dataUrl.split(',')[1];
                    zip.file(result.filename, base64Data, { base64: true });
                });
               
                zip.generateAsync({ type: 'blob' }).then(content => {
                    saveAs(content, `batch_export_${new Date().toISOString().slice(0, 10)}.zip`);
                    elements.statusText.innerHTML = `📦 <strong>Batch Export Complete!</strong> ${results.length} files`;
                }).catch(error => {
                    elements.statusText.innerHTML = `❌ <strong>Export Failed:</strong> ${error.message}`;
                });
            }
            
            function resetSettings() {
                Object.entries(DEFAULT_SETTINGS).forEach(([key, value]) => {
                    const element = document.getElementById(key);
                    if (element) element.value = value;
                });
                updateSliderValues();
                updatePreview();
                elements.statusText.innerHTML = `
                    🔄 <strong>Reset Complete!</strong> All settings restored to professional defaults
                    <br><small>Ready for your next masterpiece ✨</small>
                `;
            }
            
            // Drag & Drop
            elements.csvDropZone.addEventListener('dragover', (e) => {
                e.preventDefault();
                elements.csvDropZone.classList.add('dragover');
            });
            
            elements.csvDropZone.addEventListener('dragleave', () => {
                elements.csvDropZone.classList.remove('dragover');
            });
            
            elements.csvDropZone.addEventListener('drop', (e) => {
                e.preventDefault();
                elements.csvDropZone.classList.remove('dragover');
               
                const files = e.dataTransfer.files;
                if (files.length > 0) {
                    const file = files[0];
                    if (file.type === 'text/csv' || file.name.endsWith('.csv') || file.name.endsWith('.txt')) {
                        const reader = new FileReader();
                        reader.onload = (event) => {
                            elements.csvInput.value = event.target.result;
                            updateItemCount();
                            updatePreview();
                            elements.statusText.innerHTML = `
                                ✅ <strong>Dropped:</strong> ${file.name}
                                <span style="color: #10b981;">(${getValidLineCount()} items loaded)</span>
                            `;
                        };
                        reader.readAsText(file);
                    } else {
                        elements.statusText.innerHTML = '❌ <strong>Invalid File:</strong> Please drop CSV or text files only';
                    }
                }
            });
            
            // CSV Toggle Event
            csvToggle.addEventListener('click', toggleCsv);
            
            // Tab Events
            tabButtons.forEach(btn => {
                btn.addEventListener('click', () => switchTab(btn.dataset.tab));
            });
            
            // Button Events
            elements.buttons.single.addEventListener('click', generateSingle);
            elements.buttons.generate.addEventListener('click', generateAll);
            elements.buttons.clear.addEventListener('click', () => {
                elements.results.innerHTML = '';
                elements.resultsPanel.style.display = 'none';
                elements.resultsCount.textContent = '(0)';
                imageCache.clear();
                elements.statusText.innerHTML = '🗑️ <strong>Results Cleared</strong> - Ready for new graphics';
            });
            elements.buttons.reset.addEventListener('click', resetSettings);
            elements.buttons.exportZip.addEventListener('click', exportAsZip);
            elements.clearCsvBtn.addEventListener('click', clearCsv);
            
            // Input Events
            elements.inputs.forEach(input => {
                input.addEventListener('input', () => {
                    updateSliderValues();
                    if (input.id === 'csvInput') {
                        updateItemCount();
                    } else {
                        updatePreview();
                    }
                });
                // Special handling for color inputs to trigger immediate preview
                if (input.type === 'color') {
                    input.addEventListener('change', updatePreview);
                }
            });
            
            // Theme Toggle - No longer affects rendering colors
            themeToggle.addEventListener('click', () => {
                document.body.classList.toggle('dark');
                document.body.classList.toggle('light');
                const isDark = document.body.classList.contains('dark');
                themeToggle.textContent = isDark ? '☀️' : '🌙';
                localStorage.setItem('theme', isDark ? 'dark' : 'light');
                // Only update UI, not rendering colors
            });
            
            // Scroll to Top
            window.addEventListener('scroll', () => {
                goToTop.style.display = window.scrollY > 300 ? 'flex' : 'none';
            });
            
            goToTop.addEventListener('click', () => {
                window.scrollTo({ top: 0, behavior: 'smooth' });
            });
            
            // Keyboard Shortcuts
            document.addEventListener('keydown', (e) => {
                if (e.ctrlKey || e.metaKey) {
                    switch (e.key) {
                        case 'Enter':
                            e.preventDefault();
                            generateSingle();
                            break;
                        case 's':
                            e.preventDefault();
                            exportAsZip();
                            break;
                        case 'r':
                            e.preventDefault();
                            resetSettings();
                            break;
                    }
                }
            });
            
            // Initialize
            const savedTheme = localStorage.getItem('theme') || 'dark';
            if (savedTheme === 'light') {
                document.body.classList.remove('dark');
                document.body.classList.add('light');
                themeToggle.textContent = '🌙';
            }
            
            // Load sample data
            elements.csvInput.value = `https://images.unsplash.com/photo-1506905925346-21bda4d32df4?w=1080&h=1920&fit=crop,https://images.unsplash.com/photo-1516589178581-6cd7833ae3b7?w=1080&h=1920&fit=crop,Professional Title,This is an amazing multi-line description that spans across several lines to demonstrate the text wrapping capabilities of this professional text overlay tool. Perfect for social media graphics!,https://images.unsplash.com/photo-1498050108023-c5249f4df085?w=1080&h=1920&fit=crop,Creative Subtitle,Short description,https://images.unsplash.com/photo-1441974231531-c6227db76b6e?w=1080&h=1920&fit=crop,,Just the image - no text overlay`;
            updateSliderValues();
            updateItemCount();
            updatePreview();
            
            // Show welcome message
            setTimeout(() => {
                elements.statusText.innerHTML = `
                    🎉 <strong>Welcome to Pro Text Overlay Studio!</strong>
                    <br><small>Try the <strong>Instagram preset</strong> or upload your own CSV data to get started ✨</small>
                `;
            }, 2000);
        });
    </script>
</body>
</html>
