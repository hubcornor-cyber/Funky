<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <title>Stylish Image Text Overlay</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; margin: 0; color: #f1f5f9; transition: background 0.3s, color 0.3s; }
        body.dark { background: linear-gradient(135deg, #1e293b, #0f172a); color: #f1f5f9; }
        body.light { background: linear-gradient(135deg, #f0f4f8, #d9e2ec); color: #2c3e50; }
        .container { display: flex; flex-direction: column; align-items: center; padding: 20px; }
        .top-row { display: flex; flex-wrap: wrap; justify-content: center; width: 100%; gap: 20px; }
        .preview-panel, .control-panel { background: rgba(30, 41, 59, 0.85); backdrop-filter: blur(12px); border-radius: 16px; padding: 16px; box-shadow: 0 6px 16px rgba(0, 0, 0, .4); flex: 1; min-width: 300px; max-width: 600px; height: auto; }
        body.light .preview-panel, body.light .control-panel, body.light .results-panel { background: rgba(255, 255, 255, 0.85); color: #2c3e50; }
        body.light h2 { color: #007bff; }
        body.light label { color: #34495e; }
        body.light input, body.light textarea, body.light select { background: #ecf0f1; color: #2c3e50; }
        body.light .slider-value, body.light .status-text { color: #7f8c8d; }
        body.light .progress-container { background: #bdc3c7; }
        body.light .btn { background: linear-gradient(135deg, #3498db, #2980b9); }
        body.light .btn:disabled { background: #95a5a6; }
        body.light .result-item { background: rgba(255, 255, 255, .9); }
        .results-panel { background: rgba(30, 41, 59, 0.85); backdrop-filter: blur(12px); border-radius: 16px; margin: 20px 0; padding: 16px; box-shadow: 0 6px 16px rgba(0, 0, 0, .4); width: 90%; max-width: 1200px; }
        h2 { margin: 0 0 8px; font-size: 16px; color: #93c5fd; }
        label { display: block; margin-top: 6px; font-weight: 600; font-size: 11px; color: #e2e8f0; }
        input, textarea, select { width: 100%; padding: 5px; margin-top: 3px; border: none; border-radius: 6px; background: #1e293b; color: #f8fafc; resize: none; font-size: 11px; }
        input[type="color"] { padding: 1px; height: 28px; cursor: pointer; }
        input[type="range"] { cursor: pointer; }
        .slider-container { display: flex; align-items: center; gap: 6px; }
        .slider-value { font-size: 10px; color: #cbd5e1; }
        .btn { display: inline-block; margin-top: 8px; padding: 6px 10px; border: none; border-radius: 6px; background: linear-gradient(135deg, #2563eb, #1d4ed8); color: #fff; cursor: pointer; font-weight: 600; font-size: 11px; transition: transform .2s, box-shadow .2s; }
        .btn:disabled { background: #4b5563; cursor: not-allowed; }
        .btn:hover:not(:disabled) { transform: scale(1.05); box-shadow: 0 4px 12px rgba(37, 99, 235, .6); }
        .progress-container { margin-top: 8px; height: 14px; background: #334155; border-radius: 6px; overflow: hidden; }
        .progress-bar { height: 100%; width: 0; background: linear-gradient(90deg, #60a5fa, #3b82f6); transition: width .3s; }
        .status-text { margin-top: 3px; font-size: 11px; color: #cbd5e1; }
        .results { display: grid; gap: 16px; grid-template-columns: repeat(auto-fit, minmax(260px, 1fr)); }
        .result-item { background: rgba(30, 41, 59, .9); border-radius: 12px; padding: 12px; box-shadow: 0 4px 10px rgba(0, 0, 0, .4); transition: transform .2s; }
        .result-item:hover { transform: translateY(-4px); }
        .result-item img { max-width: 100%; border-radius: 8px; }
        .preview { text-align: center; }
        .preview canvas { max-width: 100%; border-radius: 12px; box-shadow: 0 4px 12px rgba(0, 0, 0, .6); }
        #themeToggle { position: fixed; top: 20px; right: 20px; z-index: 1000; }
        #goToTop { position: fixed; bottom: 20px; right: 20px; z-index: 1000; padding: 10px 15px; border-radius: 50%; font-size: 14px; display: none; }
        .control-columns { display: flex; gap: 20px; margin-top: 6px; }
        .color-column, .align-column { flex: 1; }
        @media (max-width: 768px) { .top-row { flex-direction: column; } .preview-panel, .control-panel, .results-panel { width: 95%; } .control-columns { flex-direction: column; gap: 10px; } }
    </style>
</head>
<body class="dark">
    <button class="btn" id="themeToggle">Switch to Light</button>
    <button class="btn" id="goToTop">â†‘ Top</button>
    <div class="container" id="layout">
        <div class="top-row">
            <div class="preview-panel">
                <h2>Preview</h2>
                <div class="preview"><canvas id="previewCanvas"></canvas></div>
            </div>
            <div class="control-panel" id="controls">
                <h2>Controls</h2>
                <label>CSV Input (image_url,title,detail_text)</label>
                <textarea id="csvInput" rows="4">https://image.lexica.art/full_jpg/80e57495-6d21-4156-80c7-11742bf8c064,Sample Title,This is detail texthttps://image.lexica.art/full_jpg/275cb6fb-33ca-4418-8611-bfc5da6a703a,Sample Title,This is detail texthttps://image.lexica.art/full_jpg/85ef1582-25b8-4801-8560-a1b6b5e01c40,Sample Title,This is detail texthttps://image.lexica.art/full_jpg/4bdafa6d-e9c4-4811-8e2a-13764083dbc0,Sample Title,This is detail texthttps://image.lexica.art/full_jpg/35e16d73-d01e-4733-9922-750c133fd56a,Sample Title,This is detail text</textarea>
                <label>Title Size</label>
                <div class="slider-container">
                    <input type="range" id="titleSize" min="10" max="100" value="36">
                    <span class="slider-value" id="titleSizeValue">36</span>
                </div>
                <label>Detail Size</label>
                <div class="slider-container">
                    <input type="range" id="detailSize" min="10" max="80" value="24">
                    <span class="slider-value" id="detailSizeValue">24</span>
                </div>
                <div class="control-columns">
                    <div class="color-column">
                        <label>Text Color</label><input type="color" id="textColor" value="#ffffff">
                        <label>Detail Background Color 1</label><input type="color" id="detailBg1" value="#00000000">
                        <label>Detail Background Color 2</label><input type="color" id="detailBg2" value="#000000">
                        <label>Detail Background Opacity</label>
                        <div class="slider-container">
                            <input type="range" id="detailBgOpacity" min="0" max="100" value="80">
                            <span class="slider-value" id="detailBgOpacityValue">80</span>
                        </div>
                        <label>Title Border Color</label><input type="color" id="titleBorderColor" value="#ffffff">
                        <label>Title Glow Color</label><input type="color" id="titleGlowColor" value="#ff0000">
                    </div>
                    <div class="align-column">
                        <label>Adjust Title Position</label>
                        <div class="slider-container">
                            <input type="range" id="titleSlider" min="0" max="200" value="0">
                            <span class="slider-value" id="titleSliderValue">0</span>
                        </div>
                        <label>Adjust Detail Position</label>
                        <div class="slider-container">
                            <input type="range" id="detailSlider" min="0" max="400" value="0">
                            <span class="slider-value" id="detailSliderValue">0</span>
                        </div>
                        <label>Title Alignment</label>
                        <select id="titleAlign">
                            <option value="center">Center</option>
                            <option value="left">Left</option>
                            <option value="right">Right</option>
                        </select>
                        <label>Detail Alignment</label>
                        <select id="detailAlign">
                            <option value="center">Center</option>
                            <option value="left">Left</option>
                            <option value="right">Right</option>
                        </select>
                        <label>Font Family</label>
                        <select id="fontFamily">
                            <option value="Segoe UI">Segoe UI</option>
                            <option value="Arial">Arial</option>
                            <option value="Roboto">Roboto</option>
                            <option value="Open Sans">Open Sans</option>
                        </select>
                        <label>Output Size</label>
                        <select id="outputSize">
                            <option value="original" selected>Original</option>
                            <option value="reel">1080x1920 (Reel)</option>
                            <option value="youtube">1920x1080 (YouTube)</option>
                        </select>
                    </div>
                </div>
                <button class="btn" id="singleBtn">Generate Single</button>
                <button class="btn" id="generateBtn">Generate All</button>
                <button class="btn" id="clearBtn">Clear Results</button>
                <button class="btn" id="resetBtn">Reset Settings</button>
                <button class="btn" id="exportZipBtn">Export as ZIP</button>
                <div class="progress-container"><div class="progress-bar" id="progressBar"></div></div>
                <div class="status-text" id="statusText">Idle</div>
            </div>
        </div>
        <div class="results-panel">
            <h2>Results</h2>
            <div id="results" class="results"></div>
        </div>
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    <script>
        // Constants
        const DEFAULT_SETTINGS = {
            titleSize: 36,
            detailSize: 24,
            textColor: '#ffffff',
            detailBg1: '#00000000',
            detailBg2: '#000000',
            detailBgOpacity: 80,
            titleBorderColor: '#ffffff',
            titleGlowColor: '#ff0000',
            titleSlider: 0,
            detailSlider: 0,
            titleAlign: 'center',
            detailAlign: 'center',
            fontFamily: 'Segoe UI',
            outputSize: 'original'
        };
        const MAX_WIDTH = 600;
        const DEBOUNCE_DELAY = 300;

        // DOM Elements
        const elements = {
            layout: document.getElementById('layout'),
            previewCanvas: document.getElementById('previewCanvas'),
            results: document.getElementById('results'),
            progressBar: document.getElementById('progressBar'),
            statusText: document.getElementById('statusText'),
            csvInput: document.getElementById('csvInput'),
            inputs: ['titleSize', 'detailSize', 'textColor', 'detailBg1', 'detailBg2', 'detailBgOpacity', 'titleBorderColor', 'titleGlowColor', 'titleSlider', 'detailSlider', 'titleAlign', 'detailAlign', 'fontFamily', 'outputSize', 'csvInput'].map(id => document.getElementById(id)),
            buttons: {
                single: document.getElementById('singleBtn'),
                generate: document.getElementById('generateBtn'),
                clear: document.getElementById('clearBtn'),
                reset: document.getElementById('resetBtn'),
                exportZip: document.getElementById('exportZipBtn')
            }
        };
        const ctx = elements.previewCanvas.getContext('2d');
        const themeToggle = document.getElementById('themeToggle');
        const goToTop = document.getElementById('goToTop');

        // Image Cache
        const imageCache = new Map();

        // Utility Functions
        const debounce = (func, delay) => {
            let timeout;
            return (...args) => {
                clearTimeout(timeout);
                timeout = setTimeout(() => func(...args), delay);
            };
        };

        const validateCsvLine = (line) => {
            const parts = line.split(',');
            return parts.length === 3 && parts.every(part => part.trim());
        };

        const loadImage = async (src) => {
            if (imageCache.has(src)) return imageCache.get(src);
            return new Promise((resolve, reject) => {
                const img = new Image();
                img.crossOrigin = 'anonymous';
                img.onload = () => {
                    imageCache.set(src, img);
                    resolve(img);
                };
                img.onerror = () => reject(new Error(`Failed to load image: ${src}`));
                img.src = src;
            });
        };

        const drawRoundedRect = (x, y, w, h, r) => {
            ctx.beginPath();
            ctx.moveTo(x + r, y);
            ctx.lineTo(x + w - r, y);
            ctx.quadraticCurveTo(x + w, y, x + w, y + r);
            ctx.lineTo(x + w, y + h - r);
            ctx.quadraticCurveTo(x + w, y + h, x + w - r, y + h);
            ctx.lineTo(x + r, y + h);
            ctx.quadraticCurveTo(x, y + h, x, y + h - r);
            ctx.lineTo(x, y + r);
            ctx.quadraticCurveTo(x, y, x + r, y);
            ctx.closePath();
        };

        const getSettings = () => ({
            titleSize: +document.getElementById('titleSize').value,
            detailSize: +document.getElementById('detailSize').value,
            textColor: document.getElementById('textColor').value,
            detailBg1: document.getElementById('detailBg1').value,
            detailBg2: document.getElementById('detailBg2').value,
            detailBgOpacity: +document.getElementById('detailBgOpacity').value,
            titleBorderColor: document.getElementById('titleBorderColor').value,
            titleGlowColor: document.getElementById('titleGlowColor').value,
            titleAlign: document.getElementById('titleAlign').value,
            detailAlign: document.getElementById('detailAlign').value,
            fontFamily: document.getElementById('fontFamily').value,
            outputSize: document.getElementById('outputSize').value
        });

        const drawTextOverlay = (img, title, detail, settings, titleOffset, detailOffset, canvasEl = elements.previewCanvas, drawingScale = 1) => {
            const ctx = canvasEl.getContext('2d');

            // Calculate crop for cover fit
            const targetRatio = canvasEl.width / drawingScale / (canvasEl.height / drawingScale); // full target aspect
            const imgRatio = img.width / img.height;
            let sx = 0, sy = 0, sw = img.width, sh = img.height;
            if (imgRatio > targetRatio) {
                sw = img.height * targetRatio;
                sx = (img.width - sw) / 2;
                sh = img.height;
            } else if (imgRatio < targetRatio) {
                sh = img.width / targetRatio;
                sy = (img.height - sh) / 2;
                sw = img.width;
            }
            ctx.drawImage(img, sx, sy, sw, sh, 0, 0, canvasEl.width, canvasEl.height);

            // Margins and paddings scaled
            const margin = 20 * drawingScale;
            const padding = 8 * drawingScale;
            const borderWidth = 2 * drawingScale;
            const glowBlur = 15 * drawingScale;
            const cornerRadius = 10 * drawingScale;

            // Title
            ctx.font = `${settings.titleSize * drawingScale}px ${settings.fontFamily}`;
            ctx.textAlign = settings.titleAlign;
            ctx.textBaseline = 'top';
            ctx.strokeStyle = settings.titleBorderColor;
            ctx.lineWidth = borderWidth;
            ctx.shadowColor = settings.titleGlowColor;
            ctx.shadowBlur = glowBlur;
            const titleX = settings.titleAlign === 'left' ? margin : settings.titleAlign === 'right' ? canvasEl.width - margin : canvasEl.width / 2;
            const titleY = margin + titleOffset * drawingScale;
            ctx.strokeText(title, titleX, titleY);
            ctx.shadowBlur = 0;
            ctx.fillStyle = settings.textColor;
            ctx.fillText(title, titleX, titleY);

            // Detail
            const lines = detail.split('\n');
            const lineHeight = settings.detailSize * drawingScale + 6 * drawingScale;
            lines.forEach((line, i) => {
                ctx.font = `${settings.detailSize * drawingScale}px ${settings.fontFamily}`;
                ctx.textAlign = settings.detailAlign;
                const textWidth = ctx.measureText(line).width;
                const detailX = settings.detailAlign === 'left' ? margin : settings.detailAlign === 'right' ? canvasEl.width - margin : canvasEl.width / 2;
                const lineY = canvasEl.height - (lines.length - i) * lineHeight - margin - detailOffset * drawingScale;
                const gradient = ctx.createLinearGradient(0, lineY - padding, 0, lineY - padding + settings.detailSize * drawingScale + padding * 2);
                gradient.addColorStop(0, settings.detailBg1);
                gradient.addColorStop(1, settings.detailBg2);
                ctx.fillStyle = gradient;
                ctx.globalAlpha = settings.detailBgOpacity / 100;
                drawRoundedRect(detailX - textWidth / 2 - padding, lineY - padding, textWidth + padding * 2, settings.detailSize * drawingScale + padding * 2, cornerRadius);
                ctx.fill();
                ctx.globalAlpha = 1;
                ctx.fillStyle = settings.textColor;
                ctx.fillText(line, detailX, lineY);
            });

            return canvasEl.toDataURL('image/png');
        };

        const updateSliderValues = () => {
            ['titleSize', 'detailSize', 'detailBgOpacity', 'titleSlider', 'detailSlider'].forEach(id => {
                const value = document.getElementById(id).value;
                document.getElementById(`${id}Value`).textContent = value;
            });
        };

        const updatePreview = debounce(async () => {
            const settings = getSettings();
            const csvLines = elements.csvInput.value.trim().split('\n').filter(l => l && validateCsvLine(l));
            if (!csvLines.length) {
                elements.statusText.textContent = 'No valid CSV input provided.';
                return;
            }
            const [src, title, detail] = csvLines[0].split(',');
            try {
                const img = await loadImage(src.trim());
                let targetW, targetH;
                if (settings.outputSize === 'original') {
                    targetW = img.width;
                    targetH = img.height;
                } else if (settings.outputSize === 'reel') {
                    targetW = 1080;
                    targetH = 1920;
                } else {
                    targetW = 1920;
                    targetH = 1080;
                }
                const maxPreview = 600;
                const previewScale = Math.min(maxPreview / targetW, maxPreview / targetH);
                const previewW = targetW * previewScale;
                const previewH = targetH * previewScale;
                elements.previewCanvas.width = previewW;
                elements.previewCanvas.height = previewH;
                drawTextOverlay(
                    img,
                    title.trim(),
                    detail.trim(),
                    settings,
                    +document.getElementById('titleSlider').value,
                    +document.getElementById('detailSlider').value,
                    elements.previewCanvas,
                    previewScale
                );
                elements.statusText.textContent = 'Preview updated.';
            } catch (e) {
                elements.statusText.textContent = `Preview failed: ${e.message}`;
            }
        }, DEBOUNCE_DELAY);

        const disableButtons = (disabled) => {
            Object.values(elements.buttons).forEach(btn => btn.disabled = disabled);
        };

        const generateSingle = async () => {
            const csvLines = elements.csvInput.value.trim().split('\n').filter(l => l && validateCsvLine(l));
            if (!csvLines.length) {
                elements.statusText.textContent = 'Please add valid CSV input first.';
                return;
            }
            disableButtons(true);
            const settings = getSettings();
            const [src, title, detail] = csvLines[0].split(',');
            try {
                const img = await loadImage(src.trim());
                let targetW, targetH;
                if (settings.outputSize === 'original') {
                    targetW = img.width;
                    targetH = img.height;
                } else if (settings.outputSize === 'reel') {
                    targetW = 1080;
                    targetH = 1920;
                } else {
                    targetW = 1920;
                    targetH = 1080;
                }
                const fullCanvas = document.createElement('canvas');
                fullCanvas.width = targetW;
                fullCanvas.height = targetH;
                const dataUrl = drawTextOverlay(
                    img,
                    title.trim(),
                    detail.trim(),
                    settings,
                    +document.getElementById('titleSlider').value,
                    +document.getElementById('detailSlider').value,
                    fullCanvas,
                    1
                );
                elements.results.innerHTML = '';
                const div = document.createElement('div');
                div.className = 'result-item';
                div.innerHTML = `<img src="${dataUrl}"><br><a class="btn" href="${dataUrl}" download="overlay.png">Download</a>`;
                elements.results.appendChild(div);
                elements.statusText.textContent = 'Single image generated!';
            } catch (e) {
                elements.statusText.textContent = `Image load failed: ${src}`;
            } finally {
                disableButtons(false);
            }
        };

        const generateAll = async () => {
            const csvLines = elements.csvInput.value.trim().split('\n').filter(l => l && validateCsvLine(l));
            if (!csvLines.length) {
                elements.statusText.textContent = 'Please add valid CSV input first.';
                return;
            }
            disableButtons(true);
            elements.results.innerHTML = '';
            const settings = getSettings();
            for (let i = 0; i < csvLines.length; i++) {
                elements.statusText.textContent = `Generating ${i + 1} of ${csvLines.length}...`;
                elements.progressBar.style.width = `${((i + 1) / csvLines.length) * 100}%`;
                const [src, title, detail] = csvLines[i].split(',');
                try {
                    const img = await loadImage(src.trim());
                    let targetW, targetH;
                    if (settings.outputSize === 'original') {
                        targetW = img.width;
                        targetH = img.height;
                    } else if (settings.outputSize === 'reel') {
                        targetW = 1080;
                        targetH = 1920;
                    } else {
                        targetW = 1920;
                        targetH = 1080;
                    }
                    const fullCanvas = document.createElement('canvas');
                    fullCanvas.width = targetW;
                    fullCanvas.height = targetH;
                    const dataUrl = drawTextOverlay(
                        img,
                        title.trim(),
                        detail.trim(),
                        settings,
                        +document.getElementById('titleSlider').value,
                        +document.getElementById('detailSlider').value,
                        fullCanvas,
                        1
                    );
                    const div = document.createElement('div');
                    div.className = 'result-item';
                    div.innerHTML = `<img src="${dataUrl}"><br><a class="btn" href="${dataUrl}" download="overlay_${i + 1}.png">Download</a>`;
                    elements.results.appendChild(div);
                } catch (e) {
                    elements.statusText.textContent = `Image load failed: ${src}`;
                }
            }
            elements.statusText.textContent = 'All images generated!';
            disableButtons(false);
        };

        const exportAsZip = async () => {
            const csvLines = elements.csvInput.value.trim().split('\n').filter(l => l && validateCsvLine(l));
            if (!csvLines.length) {
                elements.statusText.textContent = 'Please add valid CSV input first.';
                return;
            }
            disableButtons(true);
            const zip = new JSZip();
            const settings = getSettings();
            for (let i = 0; i < csvLines.length; i++) {
                elements.statusText.textContent = `Preparing ${i + 1} of ${csvLines.length} for ZIP...`;
                elements.progressBar.style.width = `${((i + 1) / csvLines.length) * 100}%`;
                const [src, title, detail] = csvLines[i].split(',');
                try {
                    const img = await loadImage(src.trim());
                    let targetW, targetH;
                    if (settings.outputSize === 'original') {
                        targetW = img.width;
                        targetH = img.height;
                    } else if (settings.outputSize === 'reel') {
                        targetW = 1080;
                        targetH = 1920;
                    } else {
                        targetW = 1920;
                        targetH = 1080;
                    }
                    const fullCanvas = document.createElement('canvas');
                    fullCanvas.width = targetW;
                    fullCanvas.height = targetH;
                    const dataUrl = drawTextOverlay(
                        img,
                        title.trim(),
                        detail.trim(),
                        settings,
                        +document.getElementById('titleSlider').value,
                        +document.getElementById('detailSlider').value,
                        fullCanvas,
                        1
                    );
                    const base64Data = dataUrl.split(',')[1];
                    zip.file(`overlay_${i + 1}.png`, base64Data, { base64: true });
                } catch (e) {
                    elements.statusText.textContent = `Image load failed: ${src}`;
                }
            }
            const content = await zip.generateAsync({ type: 'blob' });
            saveAs(content, 'overlays.zip');
            elements.statusText.textContent = 'ZIP file downloaded!';
            disableButtons(false);
        };

        const resetSettings = () => {
            document.getElementById('titleSize').value = DEFAULT_SETTINGS.titleSize;
            document.getElementById('detailSize').value = DEFAULT_SETTINGS.detailSize;
            document.getElementById('textColor').value = DEFAULT_SETTINGS.textColor;
            document.getElementById('detailBg1').value = DEFAULT_SETTINGS.detailBg1;
            document.getElementById('detailBg2').value = DEFAULT_SETTINGS.detailBg2;
            document.getElementById('detailBgOpacity').value = DEFAULT_SETTINGS.detailBgOpacity;
            document.getElementById('titleBorderColor').value = DEFAULT_SETTINGS.titleBorderColor;
            document.getElementById('titleGlowColor').value = DEFAULT_SETTINGS.titleGlowColor;
            document.getElementById('titleSlider').value = DEFAULT_SETTINGS.titleSlider;
            document.getElementById('detailSlider').value = DEFAULT_SETTINGS.detailSlider;
            document.getElementById('titleAlign').value = DEFAULT_SETTINGS.titleAlign;
            document.getElementById('detailAlign').value = DEFAULT_SETTINGS.detailAlign;
            document.getElementById('fontFamily').value = DEFAULT_SETTINGS.fontFamily;
            document.getElementById('outputSize').value = DEFAULT_SETTINGS.outputSize;
            updateSliderValues();
            updatePreview();
            elements.statusText.textContent = 'Settings reset to default.';
        };

        // Event Listeners
        elements.buttons.single.addEventListener('click', generateSingle);
        elements.buttons.generate.addEventListener('click', generateAll);
        elements.buttons.clear.addEventListener('click', () => {
            elements.results.innerHTML = '';
            imageCache.clear();
            elements.statusText.textContent = 'Results cleared.';
        });
        elements.buttons.reset.addEventListener('click', resetSettings);
        elements.buttons.exportZip.addEventListener('click', exportAsZip);
        elements.inputs.forEach(input => input.addEventListener('input', () => {
            updateSliderValues();
            updatePreview();
        }));
        themeToggle.addEventListener('click', () => {
            document.body.classList.toggle('dark');
            document.body.classList.toggle('light');
            themeToggle.textContent = document.body.classList.contains('dark') ? 'Switch to Light' : 'Switch to Dark';
        });
        window.addEventListener('scroll', () => {
            goToTop.style.display = (window.scrollY > 100) ? 'block' : 'none';
        });
        goToTop.addEventListener('click', () => {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        });

        // Initialize
        updateSliderValues();
        updatePreview();
    </script>
</body>
</html>
