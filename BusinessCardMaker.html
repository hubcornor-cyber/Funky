<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Business Card Editor</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <style>
    body {
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      margin: 0;
      background-color: #e8ecef;
      font-family: Arial, sans-serif;
      overflow-x: hidden;
    }

    .card-mockup {
      width: 350px;
      height: 200px;
      background-color: #fff;
      border-radius: 10px;
      box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2), 0 0 10px rgba(0, 0, 0, 0.1);
      transform: perspective(1000px) rotateY(5deg) rotateX(5deg);
      overflow: hidden;
      position: relative;
      transition: transform 0.3s ease;
    }

    .card-mockup:hover {
      transform: perspective(1000px) rotateY(0deg) rotateX(0deg);
    }

    .card-image {
      width: 100%;
      height: 100%;
      object-fit: cover;
      border-radius: 10px;
      position: absolute;
      top: 0;
      left: 0;
      z-index: 1;
    }

    .card-overlay, .logo {
      position: absolute;
      z-index: 2;
      cursor: move;
      user-select: none;
      transform-origin: center;
    }

    .card-overlay {
      bottom: 10px;
      left: 10px;
      color: #fff;
      text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5);
      font-size: 0.9em;
    }

    .card-overlay h3 {
      margin: 0;
      font-size: 1.2em;
    }

    .card-overlay p {
      margin: 5px 0 0;
      font-size: 0.8em;
    }

    .logo {
      top: 10px;
      right: 10px;
      max-width: 50px;
      max-height: 50px;
    }

    .resize-handle {
      position: absolute;
      bottom: -5px;
      right: -5px;
      width: 10px;
      height: 10px;
      background-color: #007bff;
      border-radius: 50%;
      cursor: se-resize;
      z-index: 3;
    }

    .controls {
      background-color: #fff;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 5px 10px rgba(0, 0, 0, 0.1);
      max-width: 300px;
    }

    .grid-overlay {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: repeating-linear-gradient(
        0deg,
        transparent,
        transparent 19px,
        rgba(0, 0, 0, 0.1) 20px
      ),
      repeating-linear-gradient(
        90deg,
        transparent,
        transparent 19px,
        rgba(0, 0, 0, 0.1) 20px
      );
      z-index: 0;
      pointer-events: none;
    }

    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.5);
      z-index: 10;
      justify-content: center;
      align-items: center;
    }

    .modal-content {
      background-color: #fff;
      padding: 20px;
      border-radius: 10px;
      max-width: 80%;
      max-height: 80%;
      overflow-y: auto;
    }

    .image-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
      gap: 10px;
    }

    .image-grid img {
      width: 100%;
      height: 100px;
      object-fit: cover;
      border-radius: 5px;
      cursor: pointer;
      transition: transform 0.2s;
    }

    .image-grid img:hover {
      transform: scale(1.05);
    }
  </style>
</head>
<body class="flex flex-col md:flex-row gap-4 p-4">
  <div class="card-mockup" id="cardMockup">
    <div class="grid-overlay" id="gridOverlay" style="display: none;"></div>
    <img src="https://static.vecteezy.com/system/resources/previews/024/140/681/non_2x/abstract-background-illustration-green-background-illustration-abstract-green-background-for-wallpaper-display-landing-page-banner-or-layout-simple-design-graphic-for-display-free-vector.jpg" alt="Business Card Mockup" class="card-image" id="cardImage">
    <div class="card-overlay" id="cardOverlay">
      <h3 contenteditable="true">John Doe</h3>
      <p contenteditable="true">Graphic Designer | john.doe@example.com</p>
      <div class="resize-handle" id="textResizeHandle"></div>
    </div>
    <img src="" alt="Logo" class="logo" id="logoImage" style="display: none;">
    <div class="resize-handle logo-resize-handle" id="logoResizeHandle" style="display: none;"></div>
  </div>
  <div class="controls">
    <div class="mb-4">
      <label class="block text-sm font-medium text-gray-700">Change Background</label>
      <input type="file" id="backgroundInput" accept="image/*" class="mt-1 block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100">
      <button id="onlineBackgroundBtn" class="mt-2 w-full py-2 px-4 bg-blue-600 text-white rounded-md hover:bg-blue-700">Choose Online Background</button>
    </div>
    <div class="mb-4">
      <label class="block text-sm font-medium text-gray-700">Add Logo</label>
      <input type="file" id="logoInput" accept="image/*" class="mt-1 block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100">
    </div>
    <div class="mb-4">
      <label class="block text-sm font-medium text-gray-700">Text Color</label>
      <input type="color" id="textColor" value="#ffffff" class="mt-1 w-full h-10">
    </div>
    <div class="mb-4">
      <label class="block text-sm font-medium text-gray-700">Font</label>
      <select id="fontSelect" class="mt-1 block w-full py-2 px-3 border border-gray-300 bg-white rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
        <option value="Arial, sans-serif">Arial</option>
        <option value="'Helvetica Neue', Helvetica, sans-serif">Helvetica</option>
        <option value="'Times New Roman', Times, serif">Times New Roman</option>
        <option value="'Georgia', serif">Georgia</option>
      </select>
    </div>
    <div class="mb-4">
      <label class="block text-sm font-medium text-gray-700">Text Rotation</label>
      <input type="range" id="textRotation" min="-180" max="180" value="0" class="mt-1 w-full">
      <span id="textRotationValue">0°</span>
    </div>
    <div class="mb-4">
      <label class="block text-sm font-medium text-gray-700">Logo Rotation</label>
      <input type="range" id="logoRotation" min="-180" max="180" value="0" class="mt-1 w-full">
      <span id="logoRotationValue">0°</span>
    </div>
    <div class="mb-4">
      <label class="flex items-center">
        <input type="checkbox" id="gridToggle" class="mr-2">
        <span class="text-sm font-medium text-gray-700">Show Grid</span>
      </label>
    </div>
    <button id="downloadBtn" class="w-full py-2 px-4 bg-blue-600 text-white rounded-md hover:bg-blue-700">Download Card</button>
  </div>

  <!-- Modal for online backgrounds -->
  <div class="modal" id="backgroundModal">
    <div class="modal-content">
      <h2 class="text-lg font-semibold mb-4">Select Background</h2>
      <div class="image-grid" id="imageGrid"></div>
      <button id="closeModal" class="mt-4 w-full py-2 px-4 bg-red-600 text-white rounded-md hover:bg-red-700">Close</button>
    </div>
  </div>

  <script>
    const backgroundImages = [
      'https://png.pngtree.com/thumb_back/fh260/back_pic/04/16/74/5158259f411ac49.jpg',
      'https://png.pngtree.com/thumb_back/fh260/back_our/20190623/ourmid/pngtree-blue-minimalistic-geometric-business-card-background-image_239792.jpg',
      'https://png.pngtree.com/thumb_back/fh260/back_our/20190623/ourmid/pngtree-blue-business-atmosphere-business-card-background-image_243064.jpg',
      'https://png.pngtree.com/thumb_back/fh260/back_our/20190623/ourmid/pngtree-simple-business-card-background-image_240069.jpg',
      'https://png.pngtree.com/thumb_back/fh260/back_our/20190623/ourmid/pngtree-blue-gradient-geometric-flat-business-card-background-image_243088.jpg',
      'https://png.pngtree.com/thumb_back/fh260/back_pic/04/32/44/085843de72ccfdd.jpg',
      'https://png.pngtree.com/thumb_back/fh260/back_our/20190623/ourmid/pngtree-simple-orange-business-card-background-image_240061.jpg',
      'https://png.pngtree.com/thumb_back/fh260/back_our/20190623/ourmid/pngtree-blue-gradient-geometric-business-card-background-image_239805.jpg',
      'https://png.pngtree.com/thumb_back/fh260/background/20190221/ourmid/pngtree-black-simple-business-invitation-card-image_40003.jpg',
      'https://png.pngtree.com/thumb_back/fh260/back_our/20190623/ourmid/pngtree-blue-geometric-business-card-background-image_239795.jpg',
      'https://png.pngtree.com/thumb_back/fh260/back_our/20190623/ourmid/pngtree-blue-geometric-business-minimalistic-business-card-background-image_237858.jpg',
      'https://png.pngtree.com/thumb_back/fh260/back_pic/04/30/10/6958403c968b168.jpg',
      'https://png.pngtree.com/thumb_back/fh260/back_our/20190623/ourmid/pngtree-orange-geometric-business-card-background-image_239807.jpg',
      'https://png.pngtree.com/thumb_back/fh260/background/20220814/pngtree-credit-card-closeup-secure-business-card-photo-image_33200936.jpg',
      'https://png.pngtree.com/thumb_back/fh260/back_pic/04/32/01/325843684478042.jpg',
      'https://png.pngtree.com/thumb_back/fh260/back_our/20190623/ourmid/pngtree-blue-geometric-flat-business-card-background-image_243066.jpg',
      'https://png.pngtree.com/thumb_back/fh260/background/20201014/pngtree-abstract-wave-blue-particle-technology-background-abstract-design-template-for-brochures-image_416109.jpg',
      'https://png.pngtree.com/thumb_back/fh260/back_pic/04/60/02/68586bb9304f478.jpg',
      'https://png.pngtree.com/thumb_back/fh260/back_our/20190623/ourmid/pngtree-red-geometric-business-card-background-image_239811.jpg',
      'https://png.pngtree.com/thumb_back/fh260/back_our/20190623/ourmid/pngtree-black-business-atmosphere-business-card-background-image_243092.jpg',
      'https://png.pngtree.com/thumb_back/fh260/background/20240509/pngtree-blue-gradient-abstract-business-card-background-vector-image_15728489.jpg',
      'https://png.pngtree.com/thumb_back/fh260/back_pic/03/87/91/6957d3a7094fbc7.jpg',
      'https://png.pngtree.com/thumb_back/fh260/background/20250928/pngtree-black-business-cards-featuring-leveld-logo-placed-on-dark-surface-next-image_19641811.webp',
      'https://png.pngtree.com/thumb_back/fh260/back_our/20190621/ourmid/pngtree-metal-texture-business-simple-creative-business-card-image_177652.jpg',
      'https://png.pngtree.com/thumb_back/fh260/back_our/20190623/ourmid/pngtree-blue-business-tech-business-card-background-image_243063.jpg',
      'https://png.pngtree.com/thumb_back/fh260/back_our/20190623/ourmid/pngtree-orange-geometric-business-card-background-image_243080.jpg',
      'https://png.pngtree.com/thumb_back/fh260/background/20210417/pngtree-business-card-background-image_610075.jpg',
      'https://png.pngtree.com/thumb_back/fh260/back_our/20190623/ourmid/pngtree-red-geometric-business-card-background-image_243062.jpg',
      'https://png.pngtree.com/thumb_back/fh260/back_our/20190623/ourmid/pngtree-blue-business-tech-business-card-background-image_239798.jpg',
      'https://png.pngtree.com/thumb_back/fh260/back_our/20190623/ourmid/pngtree-red-black-business-atmosphere-business-card-background-image_239810.jpg',
      'https://png.pngtree.com/thumb_back/fh260/back_our/20190623/ourmid/pngtree-black-business-atmosphere-business-card-background-image_239814.jpg',
      'https://png.pngtree.com/thumb_back/fh260/background/20220218/pngtree-black-and-red-metal-superhero-business-card-background-image_957823.jpg',
      'https://png.pngtree.com/thumb_back/fh260/back_our/20190623/ourmid/pngtree-black-business-atmosphere-business-card-background-image_239793.jpg',
      'https://png.pngtree.com/thumb_back/fh260/background/20210817/pngtree-geometric-business-card-red-business-background-image_762944.jpg',
      'https://png.pngtree.com/thumb_back/fh260/background/20220825/pngtree-a-womans-hand-grasping-a-bunch-of-sleek-black-business-cards-with-no-writing-photo-image_33447890.jpg',
      'https://png.pngtree.com/thumb_back/fh260/background/20250925/pngtree-stacks-of-business-cards-featuring-a-stylized-logo-set-against-vibrant-image_19621885.webp',
      'https://png.pngtree.com/thumb_back/fh260/background/20250925/pngtree-organized-modern-workspace-flat-lay-with-notebook-pen-wallet-and-business-image_19622394.webp',
      'https://png.pngtree.com/thumb_back/fh260/back_our/20190621/ourmid/pngtree-geometric-business-minimalistic-creative-business-card-image_177647.jpg',
      'https://png.pngtree.com/thumb_back/fh260/background/20220215/pngtree-metal-wire-drawing-texture-business-simple-gray-business-card-background-image_926058.jpg',
      'https://png.pngtree.com/thumb_back/fh260/back_our/20190623/ourmid/pngtree-blue-business-atmosphere-business-card-background-image_239808.jpg',
      'https://png.pngtree.com/thumb_back/fh260/back_our/20190623/ourmid/pngtree-blue-geometric-business-tech-business-card-background-image_239809.jpg',
      'https://png.pngtree.com/thumb_back/fh260/background/20220922/pngtree-multilingual-corporate-business-cards-for-festive-christmas-greetings-in-europe-photo-image_33883244.jpg',
      'https://png.pngtree.com/thumb_back/fh260/background/20220218/pngtree-gold-brushed-business-card-background-image_966280.jpg',
      'https://png.pngtree.com/thumb_back/fh260/back_our/20190623/ourmid/pngtree-blue-geometric-flat-business-card-background-image_243081.jpg',
      'https://png.pngtree.com/thumb_back/fh260/background/20230207/pngtree-abstract-blue-gradient-geometric-business-card-background-image_1541501.jpg',
      'https://png.pngtree.com/thumb_back/fh260/back_our/20190623/ourmid/pngtree-black-business-atmosphere-business-card-background-image_243086.jpg',
      'https://png.pngtree.com/thumb_back/fh260/back_our/20190617/ourmid/pngtree-black-atmospheric-texture-business-card-background-material-image_128513.jpg',
      'https://png.pngtree.com/thumb_back/fh260/back_our/20190623/ourmid/pngtree-red-business-atmosphere-business-card-background-image_243061.jpg',
      'https://png.pngtree.com/thumb_back/fh260/background/20220623/pngtree-flyer-business-card-background-template-image_1415171.jpg',
      'https://png.pngtree.com/thumb_back/fh260/background/20220922/pngtree-european-language-merry-christmas-greetings-for-corporate-business-card-photo-image_33883014.jpg',
      'https://png.pngtree.com/thumb_back/fh260/back_our/20190623/ourmid/pngtree-blue-line-business-atmosphere-business-card-background-image_239812.jpg',
      'https://png.pngtree.com/thumb_back/fh260/back_our/20190622/ourmid/pngtree-geometric-puzzle-color-business-card-background-image_218472.jpg',
      'https://png.pngtree.com/thumb_back/fh260/back_our/20190623/ourmid/pngtree-black-halo-business-technology-business-card-background-image_239821.jpg',
      'https://png.pngtree.com/thumb_back/fh260/back_our/20190628/ourmid/pngtree-flower-shop-business-card-image_264152.jpg',
      'https://png.pngtree.com/thumb_back/fh260/background/20190221/ourmid/pngtree-business-invitation-card-synthesis-simple-image_16652.jpg',
      'https://png.pngtree.com/thumb_back/fh260/back_our/20190623/ourmid/pngtree-black-business-atmosphere-business-card-background-image_239797.jpg',
      'https://png.pngtree.com/thumb_back/fh260/back_our/20190623/ourmid/pngtree-black-geometric-business-card-background-image_239817.jpg',
      'https://png.pngtree.com/thumb_back/fh260/back_our/20190622/ourmid/pngtree-texture-geometric-business-card-frosted-background-image_217199.jpg',
      'https://png.pngtree.com/thumb_back/fh260/back_our/20190621/ourmid/pngtree-business-minimalist-creative-business-card-image_177667.jpg',
      'https://png.pngtree.com/thumb_back/fh260/back_our/20190623/ourmid/pngtree-blue-geometric-business-card-background-image_239791.jpg',
      'https://png.pngtree.com/thumb_back/fh260/back_our/20190623/ourmid/pngtree-black-business-atmosphere-business-card-background-image_243069.jpg',
      'https://png.pngtree.com/thumb_back/fh260/back_our/20190623/ourmid/pngtree-red-geometric-lines-business-card-background-image_239790.jpg',
      'https://png.pngtree.com/thumb_back/fh260/back_our/20190621/ourmid/pngtree-blue-business-minimalistic-creative-business-card-image_177654.jpg',
      'https://png.pngtree.com/thumb_back/fh260/back_our/20190623/ourmid/pngtree-business-geometric-contrast-color-business-card-background-image_237854.jpg',
      'https://png.pngtree.com/thumb_back/fh260/background/20200718/pngtree-islamic-new-year-greeting-card-business-background-image_358319.jpg',
      'https://png.pngtree.com/thumb_back/fh260/back_our/20190621/ourmid/pngtree-blue-technology-fashion-business-card-image_177277.jpg'
    ];

    const cardMockup = document.getElementById('cardMockup');
    const cardImage = document.getElementById('cardImage');
    const cardOverlay = document.getElementById('cardOverlay');
    const logoImage = document.getElementById('logoImage');
    const textResizeHandle = document.getElementById('textResizeHandle');
    const logoResizeHandle = document.getElementById('logoResizeHandle');
    const backgroundInput = document.getElementById('backgroundInput');
    const logoInput = document.getElementById('logoInput');
    const textColor = document.getElementById('textColor');
    const fontSelect = document.getElementById('fontSelect');
    const textRotation = document.getElementById('textRotation');
    const logoRotation = document.getElementById('logoRotation');
    const textRotationValue = document.getElementById('textRotationValue');
    const logoRotationValue = document.getElementById('logoRotationValue');
    const gridToggle = document.getElementById('gridToggle');
    const gridOverlay = document.getElementById('gridOverlay');
    const downloadBtn = document.getElementById('downloadBtn');
    const onlineBackgroundBtn = document.getElementById('onlineBackgroundBtn');
    const backgroundModal = document.getElementById('backgroundModal');
    const imageGrid = document.getElementById('imageGrid');
    const closeModal = document.getElementById('closeModal');

    // Populate image grid
    function populateImageGrid() {
      imageGrid.innerHTML = '';
      backgroundImages.forEach((url, index) => {
        const img = document.createElement('img');
        img.src = url;
        img.alt = `Background ${index + 1}`;
        img.addEventListener('click', () => {
          cardImage.src = url;
          backgroundModal.style.display = 'none';
        });
        imageGrid.appendChild(img);
      });
    }

    // Open/close modal
    onlineBackgroundBtn.addEventListener('click', () => {
      populateImageGrid();
      backgroundModal.style.display = 'flex';
    });

    closeModal.addEventListener('click', () => {
      backgroundModal.style.display = 'none';
    });

    // Close modal when clicking outside
    backgroundModal.addEventListener('click', (e) => {
      if (e.target === backgroundModal) {
        backgroundModal.style.display = 'none';
      }
    });

    // Drag functionality
    function makeDraggable(element) {
      let isDragging = false;
      let currentX, currentY, initialX, initialY;

      element.addEventListener('mousedown', startDragging);
      element.addEventListener('touchstart', startDragging, { passive: false });

      function startDragging(e) {
        e.preventDefault();
        isDragging = true;
        const clientX = e.type === 'touchstart' ? e.touches[0].clientX : e.clientX;
        const clientY = e.type === 'touchstart' ? e.touches[0].clientY : e.clientY;
        initialX = clientX - (parseFloat(element.style.left) || 0);
        initialY = clientY - (parseFloat(element.style.top) || 0);
        document.addEventListener('mousemove', drag);
        document.addEventListener('touchmove', drag, { passive: false });
        document.addEventListener('mouseup', stopDragging);
        document.addEventListener('touchend', stopDragging);
      }

      function drag(e) {
        if (!isDragging) return;
        e.preventDefault();
        const clientX = e.type === 'touchmove' ? e.touches[0].clientX : e.clientX;
        const clientY = e.type === 'touchmove' ? e.touches[0].clientY : e.clientY;
        const rect = cardMockup.getBoundingClientRect();
        let x = clientX - initialX;
        let y = clientY - initialY;

        // Snap to grid if enabled
        if (gridToggle.checked) {
          x = Math.round(x / 20) * 20;
          y = Math.round(y / 20) * 20;
        }

        // Constrain within card boundaries
        x = Math.max(0, Math.min(x, rect.width - element.offsetWidth));
        y = Math.max(0, Math.min(y, rect.height - element.offsetHeight));

        element.style.left = `${x}px`;
        element.style.top = `${y}px`;
        element.style.bottom = 'auto';
        element.style.right = 'auto';
      }

      function stopDragging() {
        isDragging = false;
        document.removeEventListener('mousemove', drag);
        document.removeEventListener('touchmove', drag);
        document.removeEventListener('mouseup', stopDragging);
        document.removeEventListener('touchend', stopDragging);
      }
    }

    makeDraggable(cardOverlay);
    makeDraggable(logoImage);

    // Resize functionality
    function makeResizable(element, handle, isImage = false) {
      let isResizing = false;
      let startWidth, startHeight, startX, startY;

      handle.addEventListener('mousedown', startResizing);
      handle.addEventListener('touchstart', startResizing, { passive: false });

      function startResizing(e) {
        e.preventDefault();
        isResizing = true;
        startWidth = element.offsetWidth;
        startHeight = element.offsetHeight;
        startX = e.type === 'touchstart' ? e.touches[0].clientX : e.clientX;
        startY = e.type === 'touchstart' ? e.touches[0].clientY : e.clientY;
        document.addEventListener('mousemove', resize);
        document.addEventListener('touchmove', resize, { passive: false });
        document.addEventListener('mouseup', stopResizing);
        document.addEventListener('touchend', stopResizing);
      }

      function resize(e) {
        if (!isResizing) return;
        e.preventDefault();
        const clientX = e.type === 'touchmove' ? e.touches[0].clientX : e.clientX;
        const clientY = e.type === 'touchmove' ? e.touches[0].clientY : e.clientY;
        const dx = clientX - startX;
        const dy = clientY - startY;
        if (isImage) {
          element.style.maxWidth = `${Math.max(20, startWidth + dx)}px`;
          element.style.maxHeight = `${Math.max(20, startHeight + dy)}px`;
        } else {
          element.style.width = `${Math.max(50, startWidth + dx)}px`;
          element.style.fontSize = `${Math.max(0.8, 0.9 + dy / 100)}em`;
        }
      }

      function stopResizing() {
        isResizing = false;
        document.removeEventListener('mousemove', resize);
        document.removeEventListener('touchmove', resize);
        document.removeEventListener('mouseup', stopResizing);
        document.removeEventListener('touchend', stopResizing);
      }
    }

    makeResizable(cardOverlay, textResizeHandle);
    makeResizable(logoImage, logoResizeHandle, true);

    // Pinch-to-resize for touch devices
    function addPinchResize(element, isImage = false) {
      let initialDistance = 0;
      let startWidth = 0;

      element.addEventListener('touchstart', (e) => {
        if (e.touches.length === 2) {
          e.preventDefault();
          const touch1 = e.touches[0];
          const touch2 = e.touches[1];
          initialDistance = Math.hypot(touch1.clientX - touch2.clientX, touch1.clientY - touch2.clientY);
          startWidth = element.offsetWidth;
        }
      });

      element.addEventListener('touchmove', (e) => {
        if (e.touches.length === 2) {
          e.preventDefault();
          const touch1 = e.touches[0];
          const touch2 = e.touches[1];
          const distance = Math.hypot(touch1.clientX - touch2.clientX, touch1.clientY - touch2.clientY);
          const scale = distance / initialDistance;
          if (isImage) {
            element.style.maxWidth = `${Math.max(20, startWidth * scale)}px`;
            element.style.maxHeight = `${Math.max(20, startWidth * scale)}px`;
          } else {
            element.style.width = `${Math.max(50, startWidth * scale)}px`;
          }
        }
      });
    }

    addPinchResize(cardOverlay);
    addPinchResize(logoImage, true);

    // Background image upload
    backgroundInput.addEventListener('change', (e) => {
      const file = e.target.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = () => {
          cardImage.src = reader.result;
        };
        reader.readAsDataURL(file);
      }
    });

    // Logo upload
    logoInput.addEventListener('change', (e) => {
      const file = e.target.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = () => {
          logoImage.src = reader.result;
          logoImage.style.display = 'block';
          logoResizeHandle.style.display = 'block';
        };
        reader.readAsDataURL(file);
      }
    });

    // Text color change
    textColor.addEventListener('input', () => {
      cardOverlay.style.color = textColor.value;
    });

    // Font selection
    fontSelect.addEventListener('change', () => {
      cardOverlay.style.fontFamily = fontSelect.value;
    });

    // Text rotation
    textRotation.addEventListener('input', () => {
      cardOverlay.style.transform = `rotate(${textRotation.value}deg)`;
      textRotationValue.textContent = `${textRotation.value}°`;
    });

    // Logo rotation
    logoRotation.addEventListener('input', () => {
      logoImage.style.transform = `rotate(${logoRotation.value}deg)`;
      logoRotationValue.textContent = `${logoRotation.value}°`;
    });

    // Grid toggle
    gridToggle.addEventListener('change', () => {
      gridOverlay.style.display = gridToggle.checked ? 'block' : 'none';
    });

    // Download card as image
    downloadBtn.addEventListener('click', () => {
      gridOverlay.style.display = 'none';
      textResizeHandle.style.display = 'none';
      logoResizeHandle.style.display = 'none';
      cardMockup.style.transform = 'none';

      html2canvas(cardMockup, { scale: 2 }).then(canvas => {
        const link = document.createElement('a');
        link.download = 'business_card.png';
        link.href = canvas.toDataURL('image/png');
        link.click();

        gridOverlay.style.display = gridToggle.checked ? 'block' : 'none';
        textResizeHandle.style.display = 'block';
        logoResizeHandle.style.display = logoImage.style.display === 'block' ? 'block' : 'none';
        cardMockup.style.transform = 'perspective(1000px) rotateY(5deg) rotateX(5deg)';
      });
    });
  </script>
</body>
</html>
